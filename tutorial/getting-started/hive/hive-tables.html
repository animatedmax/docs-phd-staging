<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Getting Started with Hive Tables |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="/stylesheets/master.css" rel="stylesheet" type="text/css" media="screen,print" />
  <link href="/stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
  <link href='http://www.gopivotal.com/misc/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js" type="text/javascript"></script>



  <script type="text/javascript">
    if (window.location.host === 'pivotalhd.docs.pivotal.io') {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-39702075-1']);
      _gaq.push(['_setDomainName', 'gopivotal.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    }
  </script>
</head>

<body class="tutorial tutorial_getting-started tutorial_getting-started_hive tutorial_getting-started_hive_hive-tables has-subnav">

<div class="viewport">
<div class='wrap'>
  <script src="//use.typekit.net/clb0qji.js" type="text/javascript"></script>
  <script type="text/javascript">
      try {
          Typekit.load();
      } catch (e) {
      }
  </script>
  <script type="text/javascript">
      document.domain = "gopivotal.com";
  </script>

  <script type="text/javascript">
    WebFontConfig = {
      google: { families: [ 'Source+Sans+Pro:300italic,400italic,300,400,600:latin' ] }
    };
    (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
      wf.type = 'text/javascript';
      wf.async = 'true';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(wf, s);
    })();
  </script>

    <header class="header header-layout">
      <h1 class="logo">
        <!-- <a href="/"> -->
            
        <!-- </a> -->
      <a href="/index.html">Pivotal HD Documentation</a></h1>
      <div class="header-links js-bar-links">
        <div class="btn-menu" data-behavior="MenuMobile"></div>
        <div class="header-item">
          <a href="http://docs.pivotal.io/index.html">Docs Home</a>
        </div>
        <!--
        <div class="header-item">
          <a href="http://support.gopivotal.com" target="_blank">Support</a>
        </div>
        -->
         <div class="header-item">
          <a href="http://ask.gopivotal.com/hc/en-us/categories/200072578-Pivotal-HD-Knowledge-Base" target="_blank">Knowledge Base</a>
        </div>
        <div class="header-item">
          <a href="http://ask.gopivotal.com/hc/communities/public/topics/200053048-Pivotal-HD-General" target="_blank">Forum</a>
        
        
        
        <div class="header-item searchbar js-searchbar">
          <a class="search-icon" data-behavior="Search"></a>
          <div class="search-input">
            <!-- Google CSE Search Box -->
            <div class="search-input-inner" id="docs-search">
                <gcse:search></gcse:search>
            </div>
          </div>
        </div>
      </div>
    </header>

  <div class="container">

      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
 <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
 <div class="nav-content">
  <ul class="menu">
              <!-- REPLACE <li/> NODES-->
              

        <li class="menu-item js-menu-item">            
      <div class="menu-title js-menu-title">
          	    <a id='home-nav-link' href="/tutorial/index.html">Getting Started with the Pivotal HD Tutorial </a>
      </div> 
         </li>
              
             <div class="menu-title js-menu-title">
                <li class="menu-link">
                  <a  href="/tutorial/getting-started-overview.html">Setting Up the Pivotal HD Tutorial</a>
             </div>
                  <ul >
                    <li class="menu-link"><a href='/tutorial/getting-started/pivotalhd-vm.html'>Pivotal HD Virtual Machine</a></li>
               
                    <li class="menu-link"><a href='/tutorial/getting-started/dataset.html'>Loading the Retail Demo Dataset</a></li>
					
                  </UL>
			    </li>
			
			  <div class="menu-title js-menu-title">
				<li class="menu-item">
				  <a  href="/tutorial/getting-started/overview.html">Tutorials Overview</a>
				</div>
				<ul >
<div class="menu-title js-menu-title">
                    <li class="menu-link"><a href='/tutorial/getting-started/map-reduce-java.html'>MapReduce Java</a>
                    </div>
                      <ul >
                        <li class="menu-link"><a href='/tutorial/getting-started/map-reduce-java/summarization-postalcode-paidamount.html'>Summarization: PostalCode with Highest Revenue</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/map-reduce-java/firstandlastorderiddate.html'>Minimum/Maximum: Last and First order date</a></li>
                      </ul>
                    </li> <div class="menu-title">
                    <li class="menu-item" ><a href='/tutorial/getting-started/hawq.html'>HAWQ</a>
						</div>
                      <ul >
                        <li class="menu-link"><a href='/tutorial/getting-started/hawq/internal-tables.html'>HAWQ Internal Tables</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/hawq/pxf-external-tables.html'>PXF External Tables: HDFS</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/hawq/pxf-hbase-external-tables.html'>PXF External Tables: HBase</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/hawq/pxf-hbase-external-enable-filter-pushdown.html'>PXF External Tables Predicate Push-down: HBase</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/hawq/pxf-external-tables-statistics.html'>PXF External Tables: Statistics</a></li>
                      </ul>
                    </li><div class="menu-title">
                    <li class="menu-item"><a href='/tutorial/getting-started/hive/hive-tables.html'>Hive</a></div>
                     <ul >
                        <li class="menu-item"><a href='/tutorial/getting-started/hive/hive-tables.html'>Hive Tables</a></li>
                      </ul> 
					
                    </li>
                     <div class="menu-title">
                    <li class="menu-item"><a href='/tutorial/getting-started/pig.html'>Pig</a>
                    </div>
                      <ul >
                        <li class="menu-link"><a href='/tutorial/getting-started/pig/summarization-postalcode-paidamount.html'>Top ten postal codes</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/pig/firstandlastorderiddate.html'>Last and First order date of all the customers</a></li>
                      </ul>
                    </li>
				
                   <!-- <li class="menu-link"><a href='/tutorial/getting-started/spring-data-hadoop.html'>Spring Data Hadoop</a>
                      <ul >
                        <li class="menu-link"><a href='/tutorial/getting-started/spring-data-hadoop/wordcount_with_spring_hadoop-gphd.html'>Word Count with Spring Data on Pivotal HD</a></li>
                        <li class="menu-link"><a href='/tutorial/getting-started/spring-data-hadoop/wordcount_with_spring_hadoop.html'>Word Count with Spring Data on Hadoop 2.2.0</a></li>
                      </ul>
                    </li>-->
                  </ul>
                </li>
			  <div class="menu-title js-menu-title">
				 <li><a href="http://gemfirexd.docs.gopivotal.com/latest/userguide/index.html#getting_started/tutorial_chapter_intro.html" target="_blank">GemFire XD Quickstart</a></li>
				 </div>
			 </ul>
                	</li>
              </ul>
           </div>   
        </div><!--end of sub-nav-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <h1 class="title-container">
            Getting Started with Hive Tables
          </h1>
            <div id="js-quick-links">
              
            </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <h1>Overview</h1>

<p>In this exercise you create Hive tables and load data into the tables using the <code>LOAD</code> Command.</p>

<h1>Prerequisites</h1>

<ol>
<li><p>Install the Pivotal HD Single-Node Virtual Machine and start the Pivotal HD services. See <a href="/tutorial/getting-started/pivotalhd-vm.html">Pivotal HD Single-Node VM</a>.</p></li>
<li><p>Load the Retail Demo Dataset before following the steps in this section. See <a href="/tutorial/getting-started/dataset.html">Retail Demo Dataset</a>.</p></li>
</ol>

<h1>Introduction</h1>

<p>HIVE is shipped as part of the Pivotal HD distribution. You use Hive to load and query data. </p>

<h1>Create Hive tables</h1>

<p>Execute the following commands to create tables in Hive:</p>

<ol>
<li><p>Start the <code>hive</code> command line interface: </p>

<pre class="terminal">
    $ hive
    hive> 
</pre></li>
<li><p>Create the database <code>retail_demo</code>:</p>

<pre class="terminal">
    CREATE DATABASE IF NOT EXISTS retail_demo;
    USE retail_demo;
</pre></li>
<li><p>Create the table <code>retail_demo.order_lineitems_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.order_lineitems_hive
(
  Order_ID                      string
, Order_Item_ID                 bigint
, Product_ID                    int
, Product_Name                  string
, Customer_ID                   int
, Store_ID                      int
, Item_Shipment_Status_Code     string
, Order_Datetime                timestamp
, Ship_Datetime                 timestamp
, Item_Return_Datetime          timestamp
, Item_Refund_Datetime          timestamp
, Product_Category_ID           int
, Product_Category_Name         string
, Payment_Method_Code           string
, Tax_Amount                    double
, Item_Quantity                 int
, Item_Price                    double
, Discount_Amount               double
, Coupon_Code                   string
, Coupon_Amount                 double
, Ship_Address_Line1            string
, Ship_Address_Line2            string
, Ship_Address_Line3            string
, Ship_Address_City             string
, Ship_Address_State            string
, Ship_Address_Postal_Code      string
, Ship_Address_Country          string
, Ship_Phone_Number             string
, Ship_Customer_Name            string
, Ship_Customer_Email_Address   string
, Ordering_Session_ID           string
, Website_URL                   string
)
  -- PARTITIONED BY (Order_Datetime timestamp)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/order_lineitems/'; </pre></li>
<li><p>Create the table <code>retail_demo.orders_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.orders_hive
(
  Order_ID                      string
, Customer_ID                   int
, Store_ID                      int
-- , Order_Datetime_Orig           timestamp
, Order_Datetime                timestamp
, Ship_Completion_Datetime      timestamp
, Return_Datetime               timestamp
, Refund_Datetime               timestamp
, Payment_Method_Code           string
, Total_Tax_Amount              double
, Total_Paid_Amount             double
, Total_Item_Quantity           int
, Total_Discount_Amount         double
, Coupon_Code                   string
, Coupon_Amount                 double
, Order_Canceled_Flag           string
, Has_Returned_Items_Flag       string
, Has_Refunded_Items_Flag       string
, Fraud_Code                    string
, Fraud_Resolution_Code         string
, Billing_Address_Line1         string
, Billing_Address_Line2         string
, Billing_Address_Line3         string
, Billing_Address_City          string
, Billing_Address_State         string
, Billing_Address_Postal_Code   string
, Billing_Address_Country       string
, Billing_Phone_Number          string
, Customer_Name                 string
, Customer_Email_Address        string
, Ordering_Session_ID           string
, Website_URL                   string
)
  -- PARTITIONED BY (Order_Datetime timestamp)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/orders/';  </pre></li>
<li><p>Create the table <code>retail_demo.products_dim_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.products_dim_hive
(
  Product_ID      int,
  Category_ID     smallint,
  Price           double,
  Product_Name    string
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/products_dim/';    </pre></li>
<li><p>Create the table <code>retail_demo.categories_dim_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.categories_dim_hive
(
  Category_ID    bigint,
  Category_Name  string
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/categories_dim/';  </pre></li>
<li><p>Create the table <code>retail_demo.email_addresses_dim_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.email_addresses_dim_hive
(
  Customer_ID     int,
  Email_Address   string
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/email_addresses_dim/';
    </pre></li>
<li><p>Create the table <code>retail_demo.date_dim_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.date_dim_hive
(
  calendar_day      timestamp,
  reporting_year    smallint,
  reporting_quarter smallint,
  reporting_month   smallint,
  reporting_week    smallint,
  reporting_dow     smallint
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/date_dim/';    </pre></li>
<li><p>Create the table <code>retail_demo.customers_dim_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.customers_dim_hive
(
  Customer_ID    bigint,
  First_Name     string,
  Last_Name      string,
  Gender         string
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/customers_dim/';   
</pre></li>
<li><p>Create the table <code>retail_demo.payment_methods_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.payment_methods_hive
(
  Payment_Method_ID    SMALLINT,
  Payment_Method_Code  string
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCATION '/retail_demo/payment_methods/'; 
</pre></li>
<li><p>Create the table <code>retail_demo.customer_addresses_dim_hive</code>:</p>

<pre class="terminal">
CREATE TABLE retail_demo.customer_addresses_dim_hive
(
  Customer_Address_ID  bigint,
  Customer_ID          bigint,
  Valid_From_Timestamp timestamp,
  Valid_To_Timestamp   timestamp,
  House_Number         string,
  Street_Name          string,
  Appt_Suite_No        string,
  City                 string,
  State_Code           string,
  Zip_Code             string,
  Zip_Plus_Four        string,
  Country              string,
  Phone_Number     d    string
)
  ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
  STORED AS TEXTFILE
  LOCAdTION '/retaiddl_demo/customer_addresses_dim/';
</pre></li>
</ol>

<p>Note: You can also execute the script <code>pivotal-samples/hive/create_hive_tables.sql</code> to create all of the tables.</p>

<h1>Loading Data into Hive Tables</h1>

<p>Run the following commands using the Hive CLI to load data from a local file system into Hive. You use the <code>LOAD</code> command in the format shown below. the <code>LOAD</code> command can load data that is saved in <code>.tsv.gz</code> format into a Hive table where the row format for delimited fields is set as <code>\t</code>.</p>

<pre class="terminal">
LOAD DATA LOCAL INPATH '/retail_demo/order_lineitems/order_lineitems.tsv.gz' OVERWRITE INTO TABLE retail_demo.order_lineitems_hive;
LOAD DATA LOCAL INPATH '/retail_demo/orders/orders.tsv.gz' OVERWRITE INTO TABLE retail_demo.orders_hive;
LOAD DATA LOCAL INPATH '/retail_demo/products_dim/products_dim.tsv.gz' OVERWRITE INTO TABLE retail_demo.products_dim_hive;
LOAD DATA LOCAL INPATH '/retail_demo/categories_dim/categories_dim.tsv.gz' OVERWRITE INTO TABLE retail_demo.categories_dim_hive;
LOAD DATA LOCAL INPATH '/retail_demo/email_addresses_dim/email_addresses_dim.tsv.gz' OVERWRITE INTO TABLE retail_demo.email_addresses_dim_hive;
LOAD DATA LOCAL INPATH '/retail_demo/date_dim/date_dim.tsv.gz' OVERWRITE INTO TABLE retail_demo.date_dim_hive;
LOAD DATA LOCAL INPATH '/retail_demo/customers_dim/customers_dim.tsv.gz' OVERWRITE INTO TABLE retail_demo.customers_dim_hive;
LOAD DATA LOCAL INPATH '/retail_demo/payment_methods/payment_methods.tsv.gz' OVERWRITE INTO TABLE retail_demo.payment_methods_hive;
LOAD DATA LOCAL INPATH '/retail_demo/customer_addresses_dim/customer_addresses_dim.tsv.gz' OVERWRITE INTO TABLE retail_demo.customer_addresses_dim_hive;
</pre>

<h1>Running Hive Queries</h1>

<p>You can now run Hive queries on the data you just loaded. Try the following simple queries to find the number of entries in each table:</p>

<ul>
<li><p>Display the number of email addresses in the table  <code>retail_demo.email_addresses_dim_hive</code>:</p>

<pre class="terminal">
hive > select count(*) from retail_demo.email_addresses_dim_hive ;
Total MapReduce jobs = 1
Launching Job 1 out of 1
....
Job 0: Map: 1  Reduce: 1   Cumulative CPU: 3.13 sec   HDFS Read: 7761205 HDFS Write: 7 SUCCESS
Total MapReduce CPU Time Spent: 3 seconds 130 msec
OK
401430
Time taken: 20.389 seconds
</pre></li>
<li><p>Display the number of customers in the table <code>retail_demo.customers_dim_hive</code>:</p>

<pre class="terminal">
hive> select count(*) from retail_demo.customers_dim_hive;
Total MapReduce jobs = 1
..
2 seconds 940 msec
Ended Job = job_1370914856264_0009
MapReduce Jobs Launched: 
Job 0: Map: 1  Reduce: 1   Cumulative CPU: 2.94 sec   HDFS Read: 4646997 HDFS Write: 7 SUCCESS
Total MapReduce CPU Time Spent: 2 seconds 940 msec
OK
401430
Time taken: 20.03 seconds
</pre></li>
</ul>

<h1>Cleaning up the Environment</h1>

<p>If you want to drop all the tables and start again, execute the following queries from the Hive CLI to drop the tables:</p>

<pre class="terminal">
DROP TABLE IF EXISTS retail_demo.order_lineitems_hive;
DROP TABLE IF EXISTS retail_demo.orders_hive;
DROP TABLE IF EXISTS retail_demo.products_dim_hive;
DROP TABLE IF EXISTS retail_demo.categories_dim_hive;
DROP TABLE IF EXISTS retail_demo.email_addresses_dim_hive;
DROP TABLE IF EXISTS retail_demo.date_dim_hive;
DROP TABLE IF EXISTS retail_demo.customers_dim_hive;
DROP TABLE IF EXISTS retail_demo.payment_methods_hive;
DROP TABLE IF EXISTS retail_demo.customer_addresses_dim_hive;
</pre>

      </main><!--end of content-->

  </div><!-- end of container -->

  <script type="text/javascript">
    (function() {
      var didInit = false;
      function initMunchkin() {
        if(didInit === false) {
          didInit = true;
          Munchkin.init('625-IUJ-009');
        }
      }
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
      s.onreadystatechange = function() {
        if (this.readyState == 'complete' || this.readyState == 'loaded') {
          initMunchkin();
        }
      };
      s.onload = initMunchkin;
      document.getElementsByTagName('head')[0].appendChild(s);
    })();
  </script>
</div><!--end of wrap-->
</div><!--end of viewport-->

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
      <a href='/'>Pivotal Documentation</a>
      &copy; 2015 <a href='http://gopivotal.com'>Pivotal Software</a>, Inc. All Rights Reserved.
  </div>
  <div class="support">
    Need help? <a href="http://support.gopivotal.com" target="_blank">Visit Support</a>
  </footer>
</div><!--end of container-->

</body>
</html>
