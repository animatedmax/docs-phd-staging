
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head><meta xmlns="http://www.w3.org/1999/xhtml" name="description" content="This chapter describes how to install additional HAWQ components. Installing Cryptographic Functions for PostgreSQL Install pgcrypto Enable PostGIS Support Uninstalling pgcrypto Installing PL/R ..."/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="copyright" content="(C) Copyright 2005"/><meta name="DC.rights.owner" content="(C) Copyright 2005"/><meta name="DC.Type" content="topic"/><meta name="DC.Title" content="Installing the HAWQ Components"/><meta name="DC.Relation" scheme="URI" content="../hawq-topics/HAWQInstallationandUpgrade.html"/><meta name="prodname" content=""/><meta name="version" content="2.1.0"/><meta name="release" content=""/><meta name="modification" content=""/><meta name="DC.Format" content="XHTML"/><meta name="DC.Identifier" content="installingthehawqcomponents"/><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>Installing the HAWQ Components</title><meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Type" content="text/html; charset=utf-8"><!----></meta><link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/commonltr.css"><!----></link><link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/pivotal.css"/><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript"><!--
          
          var prefix = "../index.html";
          
          --></script><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" src="../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" src="../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" src="../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" charset="utf-8" src="../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" id="installingthehawqcomponents"><script xmlns="http://www.w3.org/1999/xhtml" src="//use.typekit.net/clb0qji.js" type="text/javascript"/><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
			  try {
				  Typekit.load();
			  } catch (e) {
			  }
		  </script><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
			  document.domain = "pivotal.io";
		  </script><script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
			WebFontConfig = {
			  google: { families: [ 'Source+Sans+Pro:300italic,400italic,300,400,600:latin' ] }
			};
			(function() {
			  var wf = document.createElement('script');
			  wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
				'://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
			  wf.type = 'text/javascript';
			  wf.async = 'true';
			  var s = document.getElementsByTagName('script')[0];
			  s.parentNode.insertBefore(wf, s);
			})();
		  </script>
<table class="nav"><tbody><tr><td colspan="2"><div id="permalink"><a href="#">linkToThis</a></div><div id="printlink"><a href="javascript:window.print();">printThisPage</a></div></td></tr><tr><td><div class="navheader">
<span class="navparent"><a class="link" href="../hawq-topics/HAWQInstallationandUpgrade.html" title="HAWQ Installation and Upgrade"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">HAWQ Installation and Upgrade</span></a></span>  </div></td><td width="75%"><a class="navheader_parent_path" href="../hawq-topics/../hawq-topics/PivotalHAWQ.html" title="Pivotal HAWQ">Pivotal HAWQ</a> / <a class="navheader_parent_path" href="../hawq-topics/HAWQInstallationandUpgrade.html" title="HAWQ Installation and Upgrade">HAWQ Installation and Upgrade</a></td></tr></tbody></table>

   <h1 class="title topictitle1">Installing the HAWQ Components</h1>

   <div class="body">
      <p class="p">This chapter describes how to install additional HAWQ components.</p>

      <ul class="ul">
         <li class="li">
            <a class="xref" href="#installingcryptographicfunctionsforpostgresql">Installing Cryptographic Functions for PostgreSQL</a>
            <ul class="ul">
               <li class="li">
                  <a class="xref" href="#installpgcrypto">Install pgcrypto</a>
               </li>

               <li class="li">
                  <a class="xref" href="#enablingpostgissupport">Enable PostGIS Support</a>
               </li>

               <li class="li">
                  <a class="xref" href="#uninstallingpgcrypto">Uninstalling pgcrypto</a>
               </li>

            </ul>

         </li>

         <li class="li">
            <a class="xref" href="#installingplr">Installing PL/R</a>
            <ul class="ul">
               <li class="li">
                  <a class="xref" href="#installplr">Install PL/R</a>
               </li>

               <li class="li">
                  <a class="xref" href="#enablingplrlanguagesupport">Enable PL/R Language Support</a>
               </li>

               <li class="li">
                  <a class="xref" href="#uninstallingplr">Uninstalling PL/R</a>
               </li>

            </ul>

         </li>

         <li class="li">
            <a class="xref" href="#installingpljava">Installing PL/Java</a>
            <ul class="ul">
               <li class="li">
                  <a class="xref" href="#installingthehawqpljavaextension">Install the HAWQ PL/Java Extension</a>
               </li>

               <li class="li">
                  <a class="xref" href="#enablingpljavaandinstallingjarfiles">Enable PL/Java and Install JAR Files</a>
               </li>

               <li class="li">
                  <a class="xref" href="#uninstallingpljava">Uninstalling PL/Java</a>
               </li>

            </ul>

         </li>

         <li class="li">
            <a class="xref" href="#installingmadlibonhawq1">Installing MADlib on HAWQ</a>
            <ul class="ul">
               <li class="li">
                  <a class="xref" href="#pre-requisitesforinstallingmadlibonhawq">Pre-requisites for Installing MADlib on HAWQ</a>
               </li>

               <li class="li">
                  <a class="xref" href="#installingmadlibonhawq2">Install MADlib on HAWQ</a>
               </li>

               <li class="li">
                  <a class="xref" href="#madlibinstallationscriptreference">MADlib Installation Script Reference</a>
               </li>

            </ul>

         </li>

      </ul>

   </div>

   <div class="related-links"/>
<div class="topic nested1" id="installingcryptographicfunctionsforpostgresql">
      <h2 class="title topictitle2">Installing Cryptographic Functions for PostgreSQL</h2>

      <div class="body">
         <p class="p">pgcrypto is available as a package that you can download from the Pivotal Download
            Center and install using the Package Manager utility (<samp class="ph codeph">gppkg</samp>).
               <samp class="ph codeph">gppkg</samp> installs pgcrypto and other HAWQ extensions, along with any
            dependencies, on all hosts across a cluster. It will also automatically install
            extensions on new hosts in the case of system expansion and segment recovery.</p>

         <div class="note note"><span class="notetitle">Note:</span> Before you install the pgcrypto software package, make sure that your HAWQ database
            is running, you have sourced <span class="ph filepath">greenplum_path.sh</span>, and that the
               <samp class="ph codeph">$MASTER_DATA_DIRECTORY</samp> and <samp class="ph codeph">$GPHOME</samp> variables are
            set.</div>

      </div>

      <div class="topic nested2" id="installpgcrypto">
         <h3 class="title topictitle3">Install pgcrypto</h3>

         <div class="body">
            <p class="p">Download the pgcrypto package from the Pivotal Download Center, then copy it to the
               master host. Install the software package by running the following command:</p>

            <pre class="pre codeblock">gppkg -i pgcrypto-1.0-rhel5-x86_64.gppkg</pre>

            <p class="p">You will see output similar to the following.</p>

            <pre class="pre codeblock">[gpadmin@gp-single-host ~]$ gppkg -i pgcrypto-1.0-rhel5-x86_64.gppkg 
20120418:23:54:20:gppkg:gp-single-host:gpadmin-[INFO]:-Starting gppkg with args: -i pgcrypto-1.0-rhel5-x86_64.gppkg
20120418:23:54:20:gppkg:gp-single-host:gpadmin-[INFO]:-Installing package pgcrypto-1.0-rhel5-x86_64.gppkg
20120418:23:54:21:gppkg:gp-single-host:gpadmin-[INFO]:-Validating rpm installation cmdStr='rpm --test -i /usr/local/greenplum-db/./.tmp/pgcrypto-1.0-1.x86_64.rpm --dbpath /usr/local/greenplum-db/./share/packages/database --prefix /usr/local/greenplum-db/.'
20120418:23:54:22:gppkg:gp-single-host:gpadmin-[INFO]:-Please run psql -d mydatabase -f $GPHOME/share/postgresql/contrib/pgcrypto.sql to enable the package.
20120418:23:54:22:gppkg:gp-single-host:gpadmin-[INFO]:-pgcrypto-1.0-rhel5-x86_64.gppkg successfully installed.</pre>

         </div>

      </div>

      <div class="topic nested2" id="enablingpostgissupport">
         <h3 class="title topictitle3">Enable PostGIS Support</h3>

         <div class="body">
            <p class="p">You must enable <samp class="ph codeph">pgcrypto</samp> support for each database that requires its
               usage. This is done by running the <span class="ph filepath">pgcrypto.sql</span> script. This
               command is required. <span class="ph filepath">pgcrypto.sql</span> contains all the pgcrypto
               functions.</p>

            <pre class="pre codeblock">psql -d dbname -f $GPHOME/share/postgresql/contrib/pgcrypto.sql</pre>

         </div>

      </div>

      <div class="topic nested2" id="uninstallingpgcrypto">
         <h3 class="title topictitle3">Uninstalling pgcrypto</h3>

         <div class="body">
            <div class="section"><h4 class="title sectiontitle">Uninstall pgcrypto support</h4>
               
               <p class="p">To uninstall the pgcrypto objects, use <span class="ph filepath">uninstall_pgcrypto.sql</span>
                  to remove pgcrypto support.</p>

               <p class="p">For each database on which you enabled pgcrypto support, execute the
                  following:</p>

               <pre class="pre codeblock">psql -d dbname -f $GPHOME/share/postgresql/contrib/uninstall_pgcrypto.sql</pre>

               <div class="note note"><span class="notetitle">Note:</span> This script does not remove dependent user-created objects. </div>

            </div>

            <div class="section"><h4 class="title sectiontitle">Uninstall the software package</h4>
               
               <p class="p">You can uninstall the pgcrypto software using the Greenplum Package Manager
                     (<span class="keyword cmdname">gppkg</span>), as follows:</p>

               <pre class="pre codeblock">gppkg -r pgcrypto-1.0</pre>

            </div>

         </div>

      </div>

   </div>

   <div class="topic nested1" id="installingplr">
      <h2 class="title topictitle2">Installing PL/R</h2>

      <div class="body">
         <p class="p">PL/R is available as a package that you can download from the Pivotal Download Center
            and install using the Package Manager utility
               (<samp class="ph codeph">gppkg</samp>). <samp class="ph codeph">gppkg</samp> installs PL/R and other Greenplum
            Database extensions, along with any dependencies, on all hosts across a cluster. It will
            also automatically install extensions on new hosts in the case of system expansion and
            segment recovery.</p>

         <div class="note note"><span class="notetitle">Note:</span> Before you install the PL/R software package, make sure that your HAWQ database is
            running, you have sourced <span class="ph filepath">greenplum_path.sh</span>, and that the
               <samp class="ph codeph">$MASTER_DATA_DIRECTORY</samp> and <samp class="ph codeph">$GPHOME</samp> variables are
            set.</div>

      </div>

      <div class="topic nested2" id="installplr">
         <h3 class="title topictitle3">Install PL/R</h3>

         <div class="body">
            <div class="p">
               <ol class="ol" id="installplr__ol_jgp_hps_zp">
                  <li class="li">Download the PL/R package from the Pivotal Download Center, then copy it to
                     the master host. Install the software package by running the following
                     command:<pre class="pre codeblock">$ gppkg -i plr-1.0-rhel5-x86_64.gppkg</pre>
</li>

                  <li class="li">Restart the database:<pre class="pre codeblock">$ gpstop -r</pre>
</li>

                  <li class="li">Source the <span class="ph filepath">$GPHOME/greenplum_path.sh</span> file. The extension
                     and the R environment are installed in the
                        <span class="ph filepath">$GPHOME/ext/R-2.13.0/</span> directory.</li>

               </ol>

            </div>

         </div>

      </div>

      <div class="topic nested2" id="enablingplrlanguagesupport">
         <h3 class="title topictitle3">Enable PL/R Language Support</h3>

         <div class="body">
            <p class="p">For each database that requires its use, register the PL/R language with the
                  <samp class="ph codeph">CREATE LANGUAGE</samp> SQL command or the <samp class="ph codeph">createlang</samp>
               utility. For example, running the following command as the <samp class="ph codeph">gpadmin</samp>
               user registers the language for a database named <samp class="ph codeph">testdb</samp>:</p>

            <pre class="pre codeblock">$ createlang plr -d testdb</pre>

            <p class="p">PL/R is registered as an untrusted language.</p>

            <p class="p">You are now ready to create new PLR functions. A library of convenient PLR functions
               may be found in <span class="ph filepath">$GPHOME/share/postgresql/contrib/plr.sql</span>. These
               functions may be installed by using the <samp class="ph codeph">psql</samp> utility to execute
                  <span class="ph filepath">plr.sql</span>, as follows:</p>

            <pre class="pre codeblock">psql -d &lt;dbname&gt; -f $GPHOME/share/postgresql/contrib/plr.sql</pre>

         </div>

      </div>

      <div class="topic nested2" id="uninstallingplr">
         <h3 class="title topictitle3">Uninstalling PL/R</h3>

         <div class="body">
            <p class="p">When you remove PL/R language support from a database, the PL/R routines that you
               created in the database will no longer work.</p>

         </div>

         <div class="topic nested3" id="removeplrsupportforadatabase">
            <h4 class="title topictitle4">Remove PL/R Support for a Database</h4>

            <div class="body">
               <p class="p">For a database that no long requires the PL/R language, remove support for PL/R
                  with the SQL command <samp class="ph codeph">DROP LANGUAGE</samp>or the
                     <samp class="ph codeph">droplang</samp> utility. For example, running the following command
                  as the <samp class="ph codeph">gpadmin</samp> user removes support for PL/R from the database
                     <samp class="ph codeph">testdb</samp>:</p>

               <pre class="pre codeblock">$ droplang plr -d testdb</pre>

            </div>

         </div>

         <div class="topic nested3" id="uninstallthesoftwarepackage">
            <h4 class="title topictitle4">Uninstall the Software Package</h4>

            <div class="body">
               <p class="p">If no databases have PL/R as a registered language, uninstall the Greenplum PL/R
                  extension with the <samp class="ph codeph">gppkg</samp> utility. This example uninstalls PL/R
                  package version 1.0:</p>

               <pre class="pre codeblock">$ gppkg -r plr-1.0</pre>

               <p class="p">You can run the <samp class="ph codeph">gppkg</samp> utility with the options <samp class="ph codeph">-q
                     --all</samp> to list the installed extensions and their versions.</p>

               <p class="p">Then, restart the database.</p>

               <pre class="pre codeblock">$ gpstop -r</pre>

               <div class="section"><h5 class="title sectiontitle">Downloading and Installing R libraries</h5>
                  
                  <p class="p">For a given R library, identify all dependent R libraries and each library's
                     web URL.This can be found by selecting the specific package from the following
                     page: <a class="xref" href="http://cran.r-project.org/web/packages/available_packages_by_name.html" target="_blank">http://cran.r-project.org/web/packages/available_packages_by_name.html</a>
                  </p>

                  <div class="p">From the page for the arm library, you can see that this library requires the
                     following R libraries:<ul class="ul" id="uninstallthesoftwarepackage__ul_mlh_mxh_tp">
                        <li class="li">Matrix</li>

                        <li class="li">lattice</li>

                        <li class="li">lme4</li>

                        <li class="li">R2WinBUGS</li>

                        <li class="li">coda</li>

                        <li class="li">abind</li>

                        <li class="li">foreign</li>

                        <li class="li">MASS</li>

                     </ul>
</div>

                  <p class="p">From the command line, use <samp class="ph codeph">wget</samp> to download the
                        <span class="ph filepath">tar.gz</span> files for the required libraries to the master
                     node:</p>

                  <pre class="pre codeblock">$ wget http://cran.r-project.org/src/contrib/arm_1.5-03.tar.gz
$ wget http://cran.r-project.org/src/contrib/Archive/Matrix/Matrix_1.0-1.tar.gz
$ wget http://cran.r-project.org/src/contrib/Archive/lattice/lattice_0.19-33.tar.gz
$ wget http://cran.r-project.org/src/contrib/lme4_0.999375-42.tar.gz
$ wget http://cran.r-project.org/src/contrib/R2WinBUGS_2.1-18.tar.gz
$ wget http://cran.r-project.org/src/contrib/coda_0.14-7.tar.gz
$ wget http://cran.r-project.org/src/contrib/abind_1.4-0.tar.gz
$ wget http://cran.r-project.org/src/contrib/foreign_0.8-49.tar.gz
$ wget http://cran.r-project.org/src/contrib/MASS_7.3-17.tar.gz</pre>

                  <p class="p">Using <samp class="ph codeph">gpscp</samp> and the hostname file, copy the
                        <span class="ph filepath">tar.gz</span> files to the same directory on all nodes of the
                     HAWQ cluster. You may require <samp class="ph codeph">root</samp> access to do this.</p>

                  <pre class="pre codeblock">$ gpscp -f /home/gpadmin/hosts_all lattice_0.19-33.tar.gz =:/home/gpadmin 
$ gpscp -f /home/gpadmin/hosts_all Matrix_1.0-1.tar.gz =:/home/gpadmin 
$ gpscp -f /home/gpadmin/hosts_all abind_1.4-0.tar.gz =:/home/gpadmin 
$ gpscp -f /home/gpadmin/hosts_all coda_0.14-7.tar.gz =:/home/gpadmin 
$ gpscp -f /home/gpadmin/hosts_all R2WinBUGS_2.1-18.tar.gz =:/home/gpadmin 
$ gpscp -f /home/gpadmin/hosts_all lme4_0.999375-42.tar.gz =:/home/gpadmin 
$ gpscp -f /home/gpadmin/hosts_all MASS_7.3-17.tar.gz =:/home/gpadmin
$ gpscp -f /home/gpadmin/hosts_all arm_1.5-03.tar.gz =:/home/gpadmin</pre>

                  <p class="p">Use <samp class="ph codeph">R CMD INSTALL</samp> to install the packages from the command
                     line. You may require <samp class="ph codeph">root</samp> access to do this.</p>

                  <pre class="pre codeblock">$ R CMD INSTALL lattice_0.19-33.tar.gz Matrix_1.0-1.tar.gz abind_1.4-0.tar.gz coda_0.14-7.tar.gz R2WinBUGS_2.1-18.tar.gz lme4_0.999375-42.tar.gz MASS_7.3-17.tar.gz arm_1.5-03.tar.gz</pre>

               </div>

            </div>

         </div>

      </div>

   </div>

   <div class="topic nested1" id="installingpljava">
      <h2 class="title topictitle2">Installing PL/Java</h2>

      <div class="body">
         <p class="p">The PL/Java extension is available as a package that you can download from the Pivotal
            Download Center and then install with the Package Manager utility
               (<samp class="ph codeph">gppkg</samp>).</p>

         <div class="note note"><span class="notetitle">Note:</span> Before you install PL/Java:<ul class="ul" id="installingpljava__ul_p5k_nft_4p">
               <li class="li">Ensure that the <samp class="ph codeph">$JAVA_HOME</samp> variable is set to the same path on
                  the master and all the segments.</li>

               <li class="li">Perform the following step on all machines to set up <samp class="ph codeph">ldconfig</samp>
                  for
                  JDK:<pre class="pre codeblock">$ echo "$JAVA_HOME/jre/lib/amd64/server" &gt; /etc/ld.so.conf.d/libjdk.conf
$ ldconfig</pre>
</li>

               <li class="li">If you are upgrading to the latest version of Java or installing it as part of
                  the expansion process, follow the instructions in the chapter, <em class="ph i">Expanding the
                     HAWQ System</em> in the <em class="ph i">HAWQ Administrator Guide</em>.</li>

               <li class="li">PL/Java is compatible with JDK 1.6 and 1.7.</li>

            </ul>
</div>


         <p class="p">The <samp class="ph codeph">gppkg</samp> utility installs HAWQ extensions, along with any
            dependencies, on all hosts across a cluster. It also automatically installs extensions
            on new hosts in the case of system expansion and segment recovery.</p>

         <p class="p">To install and use PL/Java:</p>

         <ol class="ol">
            <li class="li">Install the PL/Java extension.</li>

            <li class="li">Enable the language for each database.</li>

            <li class="li">Install user-created JAR files containing Java methods on all HAWQ hosts.</li>

            <li class="li">Add the name of the JAR file to the HAWQ <samp class="ph codeph">pljava_classpath</samp>
               environment variable. The variable lists the installed JAR files.</li>

         </ol>

         <div class="note note"><span class="notetitle">Note:</span> Before you install the PL/Java extension, make sure that your Greenplum database is
            running, you have sourced <span class="ph filepath">greenplum_path.sh</span>, and that the
               <samp class="ph codeph">$MASTER_DATA_DIRECTORY</samp> and <samp class="ph codeph">$GPHOME</samp> variables are
            set.</div>

      </div>

      <div class="topic nested2" id="installingthehawqpljavaextension">
         <h3 class="title topictitle3">Install the HAWQ PL/Java Extension</h3>

         <div class="body">
            <div class="p">
               <ol class="ol" id="installingthehawqpljavaextension__ol_tk1_4qs_zp">
                  <li class="li">Download the PL/Java extension package from the Pivotal Download Center and
                     copy it to the master host.</li>

                  <li class="li">Install the software extension package by running the <samp class="ph codeph">gppkg</samp>
                     command. This example installs the PL/Java extension package on a Linux
                     system:<pre class="pre codeblock">$ gppkg -i pljava-1.1-rhel5-x86_64.gppkg</pre>
</li>

                  <li class="li">Restart the database:<pre class="pre codeblock">$ gpstop -r</pre>
</li>

                  <li class="li">Source the <span class="ph filepath">$GPHOME/greenplum_path.sh</span> file.</li>

               </ol>

            </div>

         </div>

      </div>

      <div class="topic nested2" id="enablingpljavaandinstallingjarfiles">
         <h3 class="title topictitle3">Enable PL/Java and Install JAR Files</h3>

         <div class="body">
            <div class="p">Perform the following steps as the HAWQ administrator <samp class="ph codeph">gpadmin</samp>:<ol class="ol" id="enablingpljavaandinstallingjarfiles__ol_hw1_tqs_zp">
                  <li class="li">Enable PL/Java by running the
                        <span class="ph filepath">$GPHOME/share/postgresql/pljava/install.sql</span> SQL script
                     in the databases that use PL/Java. For example, this example enables PL/Java on
                     a database named
                     <samp class="ph codeph">mytestdb</samp>:<pre class="pre codeblock">$ psql -d mytestdb -f $GPHOME/share/postgresql/pljava/install.sql</pre>
The
                        <span class="ph filepath">install.sql</span> script registers both the trusted and
                     untrusted PL/Java.</li>

                  <li class="li">Copy your Java archives (JAR files) to
                        <span class="ph filepath">$GPHOME/lib/postgresql/java/</span> on all the HAWQ hosts.
                     This example uses the <span class="keyword cmdname">gpscp</span> utility to copy the
                        <span class="ph filepath">myclasses.jar</span>
                     file:<pre class="pre codeblock">$ gpscp -f gphosts_file myclasses.jar =:/usr/local/greenplum-db/lib/postgresql/java/</pre>
The
                        <span class="ph filepath">gphosts_file</span> file contains a list of the Greenplum
                     Database hosts.</li>

                  <li class="li">Set the <samp class="ph codeph">pljava_classpath</samp> server configuration parameter in
                     the master <span class="ph filepath">postgresql.conf</span> file. The parameter value is a
                     colon (<samp class="ph codeph">:</samp>) separated list of the JAR files containing the Java
                     classes used in any PL/Java functions. For
                     example:<pre class="pre codeblock">$ gpconfig -c pljava_classpath -v \'examples.jar:myclasses.jar\' --masteronly</pre>
</li>

                  <li class="li">Restart the database:<pre class="pre codeblock">$ gpstop -r</pre>
</li>

                  <li class="li"><strong class="ph b">(Optional)</strong> Pivotal provides an <span class="ph filepath">examples.sql</span> file
                     containing sample PL/Java functions that you can use for testing. Run the
                     commands in this file to create the test functions (which use the Java classes
                     in
                     examples.jar):<pre class="pre codeblock">$ psql -f $GPHOME/share/postgresql/pljava/examples.sql</pre>
Enabling
                     the PL/Java extension in the <samp class="ph codeph">template1</samp> database enables
                     PL/Java in any new Greenplum
                     databases:<pre class="pre codeblock">$ psql template1 -f $GPHOME/share/postgresql/pljava/install.sql</pre>
</li>

               </ol>
</div>

         </div>

         <div class="topic nested3" id="configuringpljavavmoptions">
            <h4 class="title topictitle4">Configuring PL/Java vmoptions</h4>

            <div class="body">
               <p class="p">PL/Java JVM options can be configured via the <samp class="ph codeph">pljava_vmoptions</samp>
                  parameter in the <span class="ph filepath">postgresql.conf</span> file. For example,
                     <samp class="ph codeph">pljava_vmoptions=-Xmx512M</samp> sets the maximum heap size of the
                  JVM. The default <samp class="ph codeph">Xmx</samp> value is set
                  to <samp class="ph codeph">-Xmx64M</samp>.</p>

            </div>

         </div>

      </div>

      <div class="topic nested2" id="uninstallingpljava">
         <h3 class="title topictitle3">Uninstalling PL/Java</h3>

         <div class="body">
            <p class="p">To uninstall PL/Java, you should:</p>

            <ol class="ol" id="uninstallingpljava__ol_gsr_xdt_4p">
               <li class="li">Remove PL/Java Support for a Database</li>

               <li class="li">Uninstall the Java JAR files and Software Package</li>

            </ol>

         </div>

         <div class="topic nested3" id="removepljavasupportforadatabase">
            <h4 class="title topictitle4">Remove PL/Java Support for a Database</h4>

            <div class="body">
               <p class="p">For a database that no long requires the PL/Java language, remove support for
                  PL/Java by running the <span class="ph filepath">uninstall.sql</span> file as the
                     <samp class="ph codeph">gpadmin</samp> user. For example, the following command disables the
                  PL/Java language in the specified database:</p>

               <pre class="pre codeblock">$ psql -d mydatabase -f $GPHOME/share/postgresql/pljava/uninstall.sql</pre>

            </div>

         </div>

         <div class="topic nested3" id="uninstallthejavajarfilesandsoftwarepackage">
            <h4 class="title topictitle4">Uninstall the Java JAR files and Software Package</h4>

            <div class="body">
               <div class="p">If no databases have PL/Java as a registered language, remove the Java JAR files
                  and uninstall the Greenplum PL/Java extension with the <samp class="ph codeph">gppkg</samp>
                     utility:<ol class="ol" id="uninstallthejavajarfilesandsoftwarepackage__ol_crt_mrs_zp">
                     <li class="li">Remove the <samp class="ph codeph">pljava_classpath</samp> server configuration parameter
                        in the master <span class="ph filepath">postgresql.conf</span> file.</li>

                     <li class="li">Remove the JAR files from the
                           <span class="ph filepath">$GPHOME/lib/postgresql/java/</span> directory of the HAWQ
                        hosts.</li>

                     <li class="li">Use the <samp class="ph codeph">gppkg</samp> utility with the <samp class="ph codeph">-r</samp> option
                        to uninstall the PL/Java extension. The following example uninstalls the
                        PL/Java extension on a Linux
                        system:<pre class="pre codeblock">$ gppkg -r pljava-1.1</pre>
You can run the
                           <samp class="ph codeph">gppkg</samp> utility with the options <samp class="ph codeph">-q --all</samp>
                        to list the installed extensions and their versions.</li>

                     <li class="li">After you uninstall the extension, restart the
                        database:<pre class="pre codeblock">$ gpstop -r</pre>
</li>

                  </ol>
</div>

            </div>

         </div>

         <div class="topic nested3" id="installingcustomjars">
            <h4 class="title topictitle4">Installing Custom JARS</h4>

            <div class="body">
               <ol class="ol" id="installingcustomjars__ol_qkr_xdt_4p">
                  <li class="li">Copy the jar file on the master host in
                        <span class="ph filepath">$GPHOME/lib/postgresql/java</span>.</li>

                  <li class="li">Copy the jar file on all segments in the same location using
                        <samp class="ph codeph">gpscp</samp> from
                     master:<pre class="pre codeblock">$ cd $GPHOME/lib/postgresql/java
$ gpscp -f ~/hosts.txt myfunc.jar =:$GPHOME/lib/postgresql/java/</pre>
</li>

                  <li class="li">Set <samp class="ph codeph">pljava_classpath</samp> to include the newly-copied jar file:
                         <ul class="ul" id="installingcustomjars__ol_vkr_xdt_4p">
                        <li class="li">From the <samp class="ph codeph">psql</samp> session, execute set to affect the
                           current
                           session:<pre class="pre codeblock">set pljava_classpath='myfunc.jar'; </pre>
</li>

                        <li class="li">To affect all sessions, use <samp class="ph codeph">gpconfig</samp>: 
                           <pre class="pre codeblock">gpconfig -c pljava_classpath -v \'myfunc.jar\' </pre>
</li>

                     </ul>
</li>

               </ol>

            </div>

         </div>

      </div>

   </div>

   <div class="topic nested1" id="installingmadlibonhawq1">
      <h2 class="title topictitle2">Installing MADlib on HAWQ</h2>

      <div class="body">
         <p class="p">The MADlib library adds statistical and machine learning functionality to HAWQ. This
            topic describes how to install MADlib on HAWQ. </p>

         <p class="p">Download the package from the Pivotal Download Center and then install it with the
            script (<span class="ph filepath">hawq_install.sh</span>) provided in the package. The script
            installs the MADlib files, but does not register MADlib functions with HAWQ databases.
            Therefore you must use the <samp class="ph codeph">madpack</samp> utility program to install,
            reinstall, or upgrade the MADlib database objects.</p>

         <div class="note note"><span class="notetitle">Note:</span> 
            <strong class="ph b">Upgrading HAWQ from 1.1 to 1.2</strong>
            <p class="p">If you have upgraded your system from HAWQ 1.1.x to HAWQ 1.2, you must install MADlib
               1.5 or higher and then run the <samp class="ph codeph">madpack</samp> utility. </p>

         </div>

      </div>

      <div class="topic nested2" id="pre-requisitesforinstallingmadlibonhawq">
         <h3 class="title topictitle3">Pre-requisites for Installing MADlib on HAWQ</h3>

         <div class="body">
            <p class="p">Check that you have completed the following tasks before running the installation
               script (<span class="ph filepath">hawq_install.sh</span>):</p>

            <ul class="ul" id="pre-requisitesforinstallingmadlibonhawq__ul_jxy_zdt_4p">
               <li class="li"><samp class="ph codeph">rpm</samp>, <samp class="ph codeph">gpssh</samp> and <samp class="ph codeph">gpscp</samp> are in
                  your <samp class="ph codeph">PATH</samp>.</li>

               <li class="li">The HAWQ binaries are installed properly on all master and segment nodes in your
                  cluster (also new segment nodes when adding new nodes).</li>

               <li class="li"><samp class="ph codeph">HOSTFILE</samp> lists all the new segment nodes.</li>

            </ul>

         </div>

      </div>

      <div class="topic nested2" id="installingmadlibonhawq2">
         <h3 class="title topictitle3">Install MADlib on HAWQ</h3>

         <div class="body">
            <ol class="ol" id="installingmadlibonhawq2__ol_wty_zdt_4p">
               <li class="li">Once HAWQ installation is complete, download the new version of MADlib for
                  Pivotal HAWQ from <a class="xref" href="http://network.pivotal.io/" target="_blank">Pivotal
                     Network</a>.</li>

               <li class="li">Create a <samp class="ph codeph">madlib</samp> directory and extract the MADlib distribution
                  into it. For example:
                     <pre class="pre codeblock">mkdir madlib
mv madlib_1.6-1.2.0.1.tgz madlib
cd madlib
tar xzvf madlib_1.6_1.2.0.1.tgz --strip-components=1</pre>
<div class="note note"><span class="notetitle">Note:</span> The
                        <samp class="ph codeph">--strip-components</samp> argument omits the top-level
                        <samp class="ph codeph">HAWQ 1.2</samp> directory when extracting the archive.</div>
</li>

               <li class="li">Navigate to the directory where the MADlib distribution archive was extracted and
                  make the HAWQ installation script (<span class="ph filepath">hawq_install.sh</span>)
                  executable. For example:<pre class="pre codeblock">chmod +x hawq_install.sh</pre>
</li>

               <li class="li">Run <span class="ph filepath">hawq_install.sh</span>:
                  <pre class="pre codeblock">hawq_install.sh -r /home/gpadmin/madlib/madlib-1.6-Linux.rpm -f /usr/local/greenplum-db/hostfile</pre>
</li>

               <li class="li">Run the following command to register MADlib in your database:
                  <pre class="pre codeblock">$GPHOME/madlib/bin/madpack -p hawq -c $USER@$HOST/$DATABASE install</pre>
</li>

               <li class="li">To test your installation, run the following command:
                  <pre class="pre codeblock">$GPHOME/madlib/bin/madpack -p hawq -c $USER@$HOST/$DATABASE install-check</pre>
</li>

            </ol>

         </div>

      </div>

      <div class="topic nested2" id="madlibinstallationscriptreference">
         <h3 class="title topictitle3">MADlib Installation Script Reference</h3>

         <div class="body">
            <p class="p">The <samp class="ph codeph">hawq_install.sh</samp> script is included in the MADlib
               distribution.</p>

            <p class="p">
               <strong class="ph b">Syntax</strong>
            </p>

            <pre class="pre codeblock">hawq_install.sh -r &lt;RPM_FILEPATH&gt; -f &lt;HOSTFILE&gt; [-s] [-d &lt;GPHOME&gt;] [--prefix &lt;MADLIB_INSTALL_PATH&gt;]

hawq_install.sh -h</pre>

            <div class="section"><h4 class="title sectiontitle">Required Parameters</h4>
               
               <dl class="dl parml">
                  
                     <dt class="dt pt dlterm">-r | --rpm-path &lt;RPM_FILEPATH&gt;</dt>

                     <dd class="dd pd">The path to the MADlib RPM file.</dd>

                  
                  
                     <dt class="dt pt dlterm">-f | --host-file &lt;HOSTFILE&gt;</dt>

                     <dd class="dd pd">The file containing the host names of all new segments.</dd>

                  
               </dl>

            </div>

            <div class="section"><h4 class="title sectiontitle">Optional Parameters</h4>
               
               <dl class="dl parml">
                  
                     <dt class="dt pt dlterm">-s | --skip-localhost</dt>

                     <dd class="dd pd">Set this option to prevent MADlib installation on the current host. Use
                        this option, for example, if installing from a system that is not part of
                        the cluster.</dd>

                  
                  
                     <dt class="dt pt dlterm">-d | --set-gphome &lt;GPHOME&gt;</dt>

                     <dd class="dd pd">Indicates the HAWQ installation path. If you do not specify one,
                        the installer uses the value stored in the environment variable
                           <samp class="ph codeph">GPHOME</samp>.</dd>

                  
                  
                     <dt class="dt pt dlterm">--prefix &lt;MADLIB_INSTALL_PATH&gt;</dt>

                     <dd class="dd pd">Indicates the MADlib installation path. If not set, will use the default
                        value in MADlib RPM.</dd>

                  
                  
                     <dt class="dt pt dlterm">-h | -? | --help</dt>

                     <dd class="dd pd">Displays help.</dd>

                  
               </dl>

            </div>

            <div class="section"><h4 class="title sectiontitle">Example</h4>
               
               <pre class="pre codeblock">hawq_install.sh -r /home/gpadmin/madlib/madlib-1.6-Linux.rpm -f /usr/local/greenplum-db/hostfile</pre>

            </div>

         </div>

      </div>

   </div>

<div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../hawq-topics/HAWQInstallationandUpgrade.html" title="HAWQ Installation and Upgrade"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">HAWQ Installation and Upgrade</span></a></span>  </div><div>
<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
      <a href="http://docs.pivotal.io" target="_blank">Pivotal Documentation</a>
      © 2014 <a href="http://www.pivotal.io/" target="_blank">Pivotal Software</a>, Inc. All Rights Reserved.
  </div>
  <div class="support">
    Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
   </div>
  </footer>
</div><!--end of container-->
</div>
</body>
</html>