<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <!-- Use title if it's in the page YAML frontmatter -->
  <title>Backing Up and Restoring HAWQ Databases | Pivotal HD Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="stylesheets/master.css" media="screen,print" rel="stylesheet" type="text/css" />
  <link href="stylesheets/print.css" media="print" rel="stylesheet" type="text/css" />
  <link href='http://www.pivotal.io/misc/favicon.ico' rel='shortcut icon'>
  <script src="javascripts/all.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    if (window.location.host === 'docs.pivotal.io') {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-39702075-1']);
      _gaq.push(['_setDomainName', 'pivotal.io']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    }
  </script>
  <!-- Confluence HTML stylesheet -->
   <link href="stylesheets/site-conf.css" media="screen,print" rel="stylesheet"  type="text/css" /> 
   
   <!-- Left-navigation code -->
    <link href="stylesheets/dcaccordion.css" rel="stylesheet" type="text/css" />
    <!--End left-navigation code -->
   
</head>

<body class="pivotalhd pivotalhd_getstarted pivotalhd_getstarted_phd-docs has-subnav">

<div class="viewport">
<div class='wrap'>
  <script src="//use.typekit.net/clb0qji.js" type="text/javascript"></script>
  <script type="text/javascript">
      try {
          Typekit.load();
      } catch (e) {
      }
  </script>
  <script type="text/javascript">
      document.domain = "pivotal.io";
  </script>

  <script type="text/javascript">
    WebFontConfig = {
      google: { families: [ 'Source+Sans+Pro:300italic,400italic,300,400,600:latin' ] }
    };
    (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
      wf.type = 'text/javascript';
      wf.async = 'true';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(wf, s);
    })();
  </script>
   
    <header class="header header-layout">
      <h1 class="logo">
        <a href="index.html">Pivotal HD Documentation</a> v2.1.0
      </h1>
      <div class="header-links js-bar-links">
        <div class="btn-menu" data-behavior="MenuMobile"></div>
        <div class="header-item">
          <a href="http://docs.pivotal.io">Docs Home</a>
        </div>
        <div class="header-item">
          <a href="http://support.pivotal.io" target="_blank">Support</a>
        </div>
        <div class="header-item searchbar js-searchbar">
          <a class="search-icon" data-behavior="Search"></a>
          <div class="search-input">
            <!-- Google CSE Search Box -->
            <div class="search-input-inner" id="docs-search">
                <gcse:search></gcse:search>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <div class="container">
    
	<!--INSERT SIDENAV -->
	<div id="sub-nav" class="nav-container">

         <p class="productname"><a href="PivotalHD.html">Pivotal HD</a></p>
         <ul>
            <li>
               <a href="PHDEnterprise2.1.0ReleaseNotes.html">PHD Enterprise 2.1.0 Release Notes</a>
            </li>
            <li>
               <a href="PHDInstallationandAdministration.html">PHD Installation and Administration</a>
               <ul>
                  <li>
                     <a href="OverviewofPHD.html">Overview of PHD</a>
                  </li>
                  <li>
                     <a href="InstallationOverview.html">Installation Overview</a>
                     <ul>
                        <li>
                           <a href="CommandLineInstallationFeatures.html">Command Line Installation Features</a>
                        </li>
                        <li>
                           <a href="DeploymentOptions.html">Deployment Options</a>
                        </li>
                        <li>
                           <a href="PlanningyourPHDClusterDeployment.html">Planning your PHD Cluster Deployment</a>
                        </li>
                        <li>
                           <a href="BestPracticesforSelectingHardware.html">Best Practices for Selecting Hardware</a>
                        </li>
                        <li>
                           <a href="BestPracticesforDeployingHadoopServices.html">Best Practices for Deploying Hadoop Services</a>
                        </li>
                        <li>
                           <a href="HighAvailabilityBestPractices.html">High Availability Best Practices</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="PHDInstallationPrerequisites.html">PHD Installation Prerequisites</a>
                     <ul>
                        <li>
                           <a href="BeforeYouBeginInstallingPHD.html">Before You Begin Installing PHD</a>
                        </li>
                        <li>
                           <a href="PHDPrerequisiteChecklist.html">PHD Prerequisite Checklist</a>
                        </li>
                        <li>
                           <a href="PHD-DNSLookup.html">PHD - DNS Lookup</a>
                        </li>
                        <li>
                           <a href="PHD-JAVAJDK.html">PHD - JAVA JDK</a>
                        </li>
                        <li>
                           <a href="PHD-VerifyPackageAccessibility.html">PHD - Verify Package Accessibility</a>
                        </li>
                        <li>
                           <a href="PHD-TurnOffiptables.html">PHD - Turn Off iptables</a>
                        </li>
                        <li>
                           <a href="PHD-DisableSELinux.html">PHD - Disable SELinux</a>
                        </li>
                        <li>
                           <a href="EPELYumRepository.html">EPEL Yum Repository</a>
                        </li>
                        <li>
                           <a href="SudoConfigurationFiles.html">Sudo Configuration Files</a>
                        </li>
                        <li>
                           <a href="FQDN.html">FQDN</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="InstallingPHDUsingtheCLI.html">Installing PHD Using the CLI</a>
                     <ul>
                        <li>
                           <a href="PHDInstallationChecklist.html">PHD Installation Checklist</a>
                        </li>
                        <li>
                           <a href="InstallingPivotalCommandCenter.html">Installing Pivotal Command Center</a>
                        </li>
                        <li>
                           <a href="ConfiguringKerberosandLDAP.html">Configuring Kerberos and LDAP</a>
                        </li>
                        <li>
                           <a href="PHD-ImportingthePackages.html">PHD - Importing the Packages</a>
                        </li>
                        <li>
                           <a href="EditingtheClusterConfigurationFiles.html">Editing the Cluster Configuration Files</a>
                        </li>
                        <li>
                           <a href="EditingtheHAWQConfigurationFile.html">Editing the HAWQ Configuration File</a>
                        </li>
                        <li>
                           <a href="ForPXFwithGemFireXD.html">For PXF with GemFire XD</a>
                        </li>
                        <li>
                           <a href="DeployingtheCluster.html">Deploying the Cluster</a>
                        </li>
                        <li>
                           <a href="StartingtheCluster.html">Starting the Cluster</a>
                        </li>
                        <li>
                           <a href="InitializingandStartingHAWQ.html">Initializing and Starting HAWQ</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="PHDPost-Installation.html">PHD Post-Installation</a>
                     <ul>
                        <li>
                           <a href="VerifyingPHDServiceStatus.html">Verifying PHD Service Status</a>
                        </li>
                        <li>
                           <a href="RunningPHDSamplePrograms.html">Running PHD Sample Programs</a>
                        </li>
                        <li>
                           <a href="Post-InstallationReferenceInformation.html">Post-Installation Reference Information</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="PHDUpgradePrerequisites.html">PHD Upgrade Prerequisites</a>
                     <ul>
                        <li>
                           <a href="UpgradePrerequisiteChecklist.html">Upgrade Prerequisite Checklist</a>
                        </li>
                        <li>
                           <a href="FileLocationsandBackups.html">File Locations and Backups</a>
                        </li>
                        <li>
                           <a href="VerifyJavaJDK.html">Verify Java JDK</a>
                        </li>
                        <li>
                           <a href="CompactHBaseTables.html">Compact HBase Tables</a>
                        </li>
                        <li>
                           <a href="SudoConfigurationFile.html">Sudo Configuration File</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="UpgradingPHD2.0.xto2.1.0.html">Upgrading PHD 2.0.x to 2.1.0</a>
                     <ul>
                        <li>
                           <a href="PHDUpgradeChecklist-2.0.xto2.1.0.html">PHD Upgrade Checklist - 2.0.x to 2.1.0</a>
                        </li>
                        <li>
                           <a href="UpgradeInstructions-2.0.xto2.1.0.html">Upgrade Instructions - 2.0.x to 2.1.0</a>
                        </li>
                        <li>
                           <a href="MovingHAWQFilespacetoHA-enabledHDFS-2.0.xto2.1.0.html">Moving HAWQ Filespace to HA-enabled HDFS - 2.0.x to 2.1.0</a>
                        </li>
                        <li>
                           <a href="UpgradeReferenceInformation-2.0.xto2.1.0.html">Upgrade Reference Information - 2.0.x to 2.1.0</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="UpgradingPHDfrom1.1.1to2.1.0.html">Upgrading PHD from 1.1.1 to 2.1.0</a>
                     <ul>
                        <li>
                           <a href="UpgradeChecklist-1.1.1to2.1.0.html">Upgrade Checklist - 1.1.1 to 2.1.0</a>
                        </li>
                        <li>
                           <a href="UpgradeInstructions-1.1.1to2.1.0.html">Upgrade Instructions - 1.1.1 to 2.1.0</a>
                        </li>
                        <li>
                           <a href="MovingHAWQFilespacetoHA-enabledHDFS-1.1.1to2.1.0.html">Moving HAWQ Filespace to HA-enabled HDFS - 1.1.1 to 2.1.0</a>
                        </li>
                        <li>
                           <a href="UpgradeReferenceInformation-1.1.1to2.1.0.html">Upgrade Reference Information - 1.1.1 to 2.1.0</a>
                        </li>
                        <li>
                           <a href="DisablingSecurityona1.1.1Cluster.html">Disabling Security on a 1.1.1 Cluster</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="AdministeringPHDUsingtheCLI.html">Administering PHD Using the CLI</a>
                     <ul>
                        <li>
                           <a href="ManagingaPHDCluster.html">Managing a PHD Cluster</a>
                           <ul>
                              <li>
                                 <a href="StartingaCluster.html">Starting a Cluster</a>
                              </li>
                              <li>
                                 <a href="StoppingaCluster.html">Stopping a Cluster</a>
                              </li>
                              <li>
                                 <a href="RestartingaCluster.html">Restarting a Cluster</a>
                              </li>
                              <li>
                                 <a href="ReconfiguringaCluster.html">Reconfiguring a Cluster</a>
                              </li>
                              <li>
                                 <a href="AddingRemovingServices.html">Adding/Removing Services</a>
                              </li>
                              <li>
                                 <a href="AddingHoststoaCluster.html">Adding Hosts to a Cluster</a>
                              </li>
                              <li>
                                 <a href="RetrievingInformationaboutaDeployedCluster.html">Retrieving Information about a Deployed Cluster</a>
                              </li>
                              <li>
                                 <a href="ListingClusters.html">Listing Clusters</a>
                              </li>
                              <li>
                                 <a href="ExpandingaCluster.html">Expanding a Cluster</a>
                              </li>
                              <li>
                                 <a href="ShrinkingaCluster.html">Shrinking a Cluster</a>
                              </li>
                              <li>
                                 <a href="DecommissioningSlaveNodes.html">Decommissioning Slave Nodes</a>
                                 <ul>
                                    <li>
                                       <a href="DecommissionNodesOverview.html">Decommission Nodes Overview</a>
                                    </li>
                                    <li>
                                       <a href="DecommissioningtheDataNode.html">Decommissioning the Data Node</a>
                                    </li>
                                    <li>
                                       <a href="DecommissioningtheYARNNodeManager.html">Decommissioning the YARN NodeManager</a>
                                    </li>
                                    <li>
                                       <a href="ShuttingDowntheSlaveNode.html">Shutting Down the Slave Node</a>
                                    </li>
                                    <li>
                                       <a href="ReplacingtheSlaveNode.html">Replacing the Slave Node</a>
                                    </li>
                                    <li>
                                       <a href="ReplacingtheSlaveNodeDisk.html">Replacing the Slave Node Disk</a>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <a href="HighAvailability.html">High Availability</a>
                                 <ul>
                                    <li>
                                       <a href="DisablingHighAvailability.html">Disabling High Availability</a>
                                    </li>
                                    <li>
                                       <a href="EnablingRe-enablingHighAvailability.html">Enabling/Re-enabling High Availability</a>
                                    </li>
                                    <li>
                                       <a href="HighAvailabilityCommandReference.html">High Availability Command Reference</a>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <a href="SecurityKerberosAuthentication.html">Security/Kerberos Authentication</a>
                                 <ul>
                                    <li>
                                       <a href="EnablingKerberosAuthentication.html">Enabling Kerberos Authentication</a>
                                    </li>
                                    <li>
                                       <a href="DisablingKerberosAuthentication.html">Disabling Kerberos Authentication</a>
                                    </li>
                                    <li>
                                       <a href="SecureModeCommands.html">Secure Mode Commands</a>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <a href="UninstallingaCluster.html">Uninstalling a Cluster</a>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <a href="ManagingHAWQ.html">Managing HAWQ</a>
                           <ul>
                              <li>
                                 <a href="InitializingHAWQ.html">Initializing HAWQ</a>
                              </li>
                              <li>
                                 <a href="StartingHAWQ.html">Starting HAWQ</a>
                              </li>
                              <li>
                                 <a href="StoppingHAWQ.html">Stopping HAWQ</a>
                              </li>
                              <li>
                                 <a href="ModifyingHAWQUserConfiguration.html">Modifying HAWQ User Configuration</a>
                              </li>
                              <li>
                                 <a href="ExpandingHAWQ.html">Expanding HAWQ</a>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <a href="ManagingPHDRolesandHosts.html">Managing PHD Roles and Hosts</a>
                        </li>
                        <li>
                           <a href="PHDServicesReference.html">PHD Services Reference</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="PHDFAQ-FrequentlyAskedQuestions.html">PHD FAQ - Frequently Asked Questions</a>
                  </li>
                  <li>
                     <a href="PHDTroubleshooting.html">PHD Troubleshooting</a>
                  </li>
                  <li>
                     <a href="PHDRESTAPIs.html">PHD REST APIs</a>
                     <ul>
                        <li>
                           <a href="SwaggerwithOAuth.html">Swagger with OAuth</a>
                        </li>
                        <li>
                           <a href="ListofPHDRESTAPIs.html">List of PHD REST APIs</a>
                        </li>
                     </ul>
                  </li>
               </ul>
            </li>
            <li>
               <a href="StackandToolsReference.html">Stack and Tools Reference</a>
               <ul>
                  <li>
                     <a href="OverviewofApacheStackandPivotalComponents.html">Overview of Apache Stack and Pivotal Components</a>
                  </li>
                  <li>
                     <a href="ManuallyInstallingandUsingPivotalHD2.1Stack.html">Manually Installing and Using Pivotal HD 2.1 Stack</a>
                     <ul>
                        <li>
                           <a href="DistributionContents.html">Distribution Contents</a>
                        </li>
                        <li>
                           <a href="ApacheConfigurationReference.html">Apache Configuration Reference</a>
                        </li>
                        <li>
                           <a href="AccessingPHD2.1.html">Accessing PHD 2.1</a>
                        </li>
                        <li>
                           <a href="HadoopHDFS.html">Hadoop HDFS</a>
                        </li>
                        <li>
                           <a href="HadoopYARN.html">Hadoop YARN</a>
                        </li>
                        <li>
                           <a href="HadoopPseudo-distributedConfiguration.html">Hadoop Pseudo-distributed Configuration</a>
                        </li>
                        <li>
                           <a href="Zookeeper.html">Zookeeper</a>
                        </li>
                        <li>
                           <a href="HBase.html">HBase</a>
                        </li>
                        <li>
                           <a href="Hive.html">Hive</a>
                        </li>
                        <li>
                           <a href="HCatalog.html">HCatalog</a>
                        </li>
                        <li>
                           <a href="Pig.html">Pig</a>
                        </li>
                        <li>
                           <a href="Mahout.html">Mahout</a>
                        </li>
                        <li>
                           <a href="Flume.html">Flume</a>
                        </li>
                        <li>
                           <a href="Sqoop.html">Sqoop</a>
                        </li>
                        <li>
                           <a href="Oozie.html">Oozie</a>
                        </li>
                        <li>
                           <a href="GraphLab.html">GraphLab</a>
                        </li>
                        <li>
                           <a href="Hamster.html">Hamster</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="ManuallyUpgradingPivotalHDStacktoPHD2.1.html">Manually Upgrading Pivotal HD Stack to PHD 2.1</a>
                  </li>
                  <li>
                     <a href="PivotalHadoopEnhancements.html">Pivotal Hadoop Enhancements</a>
                  </li>
                  <li>
                     <a href="Security.html">Security</a>
                     <ul>
                        <li>
                           <a href="SecurityOverview.html">Security Overview</a>
                        </li>
                        <li>
                           <a href="KerberosSetup.html">Kerberos Setup</a>
                        </li>
                        <li>
                           <a href="LDAPSetup.html">LDAP Setup</a>
                        </li>
                        <li>
                           <a href="ConfiguringKerberosforHDFSandYARNMapReduce.html">Configuring Kerberos for HDFS and YARN (MapReduce)</a>
                        </li>
                        <li>
                           <a href="ConfiguringKerberosforHDFSHighAvailability.html">Configuring Kerberos for HDFS High Availability</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureZookeeper.html">Configuring Secure Zookeeper</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureHBase.html">Configuring Secure HBase</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureHive.html">Configuring Secure Hive</a>
                        </li>
                        <li>
                           <a href="ConfiguringHCatalogWebHCatonSecureHive.html">Configuring HCatalog (WebHCat) on Secure Hive</a>
                        </li>
                        <li>
                           <a href="ConfiguringHAWQonSecureHDFS.html">Configuring HAWQ on Secure HDFS</a>
                        </li>
                        <li>
                           <a href="EnablingAuditing.html">Enabling Auditing</a>
                        </li>
                        <li>
                           <a href="SecureWebAccess.html">Secure Web Access</a>
                        </li>
                        <li>
                           <a href="SecureWebAccessviaHttpFS.html">Secure Web Access via HttpFS</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureFlume.html">Configuring Secure Flume</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureOozie.html">Configuring Secure Oozie</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureSqoop.html">Configuring Secure Sqoop</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecurePig.html">Configuring Secure Pig</a>
                        </li>
                        <li>
                           <a href="ConfiguringSecureMahout.html">Configuring Secure Mahout</a>
                        </li>
                        <li>
                           <a href="Security-Troubleshooting.html">Security - Troubleshooting</a>
                        </li>
                     </ul>
                  </li>
               </ul>
            </li>
         </ul>

         <p class="productname"><a href="PivotalCommandCenter.html">Pivotal Command Center</a></p>
         <ul>
            <li>
               <a href="PCC2.3.0ReleaseNotes.html">PCC 2.3.0 Release Notes</a>
            </li>
            <li>
               <a href="PCCUserGuide.html">PCC User Guide</a>
               <ul>
                  <li>
                     <a href="PCCOverview.html">PCC Overview</a>
                  </li>
                  <li>
                     <a href="PCCInstallationPrerequisites.html">PCC Installation Prerequisites</a>
                     <ul>
                        <li>
                           <a href="BeforeYouBeginInstallingPCC.html">Before You Begin Installing PCC</a>
                        </li>
                        <li>
                           <a href="PCCPrerequisiteChecklist.html">PCC Prerequisite Checklist</a>
                        </li>
                        <li>
                           <a href="PCC-DNSLookup.html">PCC - DNS Lookup</a>
                        </li>
                        <li>
                           <a href="PCC-JAVAJDK.html">PCC - JAVA JDK</a>
                        </li>
                        <li>
                           <a href="PCC-VerifyPackageAccessibility.html">PCC - Verify Package Accessibility</a>
                        </li>
                        <li>
                           <a href="PCC-TurnOffiptables.html">PCC - Turn Off iptables</a>
                        </li>
                        <li>
                           <a href="PCC-DisableSELinux.html">PCC - Disable SELinux</a>
                        </li>
                        <li>
                           <a href="PCC-EPELYumRepository.html">PCC - EPEL Yum Repository</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="InstallationInstructions.html">Installation Instructions</a>
                     <ul>
                        <li>
                           <a href="SupportedPlatformsandBrowsers.html">Supported Platforms and Browsers</a>
                        </li>
                        <li>
                           <a href="PCCInstallationChecklist.html">PCC Installation Checklist</a>
                        </li>
                        <li>
                           <a href="InstallPCC.html">Install PCC</a>
                        </li>
                        <li>
                           <a href="PCC-ImportingthePackages.html">PCC - Importing the Packages</a>
                        </li>
                        <li>
                           <a href="LaunchingPCC.html">Launching PCC</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="UninstallingPCC.html">Uninstalling PCC</a>
                  </li>
                  <li>
                     <a href="UpgradingPCC.html">Upgrading PCC</a>
                  </li>
                  <li>
                     <a href="UsingPCC.html">Using PCC</a>
                     <ul>
                        <li>
                           <a href="PCCUIOverview.html">PCC UI Overview</a>
                        </li>
                        <li>
                           <a href="LoggingIn.html">Logging In</a>
                        </li>
                        <li>
                           <a href="PCCUISettings.html">PCC UI Settings</a>
                        </li>
                        <li>
                           <a href="PCCUIUserManagement.html">PCC UI User Management</a>
                        </li>
                        <li>
                           <a href="ClusterStatusPage.html">Cluster Status Page</a>
                        </li>
                        <li>
                           <a href="ConfiguringandDeployingaCluster.html">Configuring and Deploying a Cluster</a>
                           <ul>
                              <li>
                                 <a href="LaunchingtheAddClusterWizard.html">Launching the Add Cluster Wizard</a>
                              </li>
                              <li>
                                 <a href="CreateClusterDefinition.html">Create Cluster Definition</a>
                              </li>
                              <li>
                                 <a href="VersionsServicesandHosts.html">Versions, Services, and Hosts</a>
                              </li>
                              <li>
                                 <a href="HostVerification.html">Host Verification</a>
                              </li>
                              <li>
                                 <a href="ClusterTopology.html">Cluster Topology</a>
                              </li>
                              <li>
                                 <a href="ClusterConfiguration.html">Cluster Configuration</a>
                              </li>
                              <li>
                                 <a href="Validation.html">Validation</a>
                              </li>
                              <li>
                                 <a href="DeploymentStatus.html">Deployment Status</a>
                              </li>
                              <li>
                                 <a href="Summary.html">Summary</a>
                              </li>
                              <li>
                                 <a href="StartingtheClusterfromtheUI.html">Starting the Cluster from the UI</a>
                              </li>
                              <li>
                                 <a href="InitializingandConfiguringHAWQ.html">Initializing and Configuring HAWQ</a>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <a href="StartingStoppingandUninstallingaCluster.html">Starting, Stopping, and Uninstalling a Cluster</a>
                        </li>
                        <li>
                           <a href="PCCUIDashboard.html">PCC UI Dashboard</a>
                        </li>
                        <li>
                           <a href="ClusterAnalysis.html">Cluster Analysis</a>
                        </li>
                        <li>
                           <a href="MapReduceJobMonitor.html">MapReduce Job Monitor</a>
                        </li>
                        <li>
                           <a href="YarnAppMonitor.html">Yarn App Monitor</a>
                        </li>
                        <li>
                           <a href="HAWQQueryMonitor.html">HAWQ Query Monitor</a>
                        </li>
                        <li>
                           <a href="Topology.html">Topology</a>
                        </li>
                        <li>
                           <a href="Logs.html">Logs</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="ConfiguringPCCforLDAP.html">Configuring PCC for LDAP</a>
                  </li>
                  <li>
                     <a href="CommandLineReference.html">Command Line Reference</a>
                  </li>
               </ul>
            </li>
         </ul>

         <p class="productname"><a href="PivotalHAWQ.html">Pivotal HAWQ</a></p>
         <ul>
            <li>
               <a href="HAWQ1.2.1ReleaseNotes.html">HAWQ 1.2.1 Release Notes</a>
            </li>
            <li>
               <a href="HAWQInstallationandUpgrade.html">HAWQ Installation and Upgrade</a>
               <ul>
                  <li>
                     <a href="PreparingtoInstallHAWQ.html">Preparing to Install HAWQ</a>
                  </li>
                  <li>
                     <a href="InstallingHAWQ.html">Installing HAWQ</a>
                  </li>
                  <li>
                     <a href="InstallingtheHAWQComponents.html">Installing the HAWQ Components</a>
                  </li>
                  <li>
                     <a href="UpgradingHAWQandComponents.html">Upgrading HAWQ and Components</a>
                  </li>
                  <li>
                     <a href="HAWQConfigurationParameterReference.html">HAWQ Configuration Parameter Reference</a>
                  </li>
               </ul>
            </li>
            <li>
               <a href="HAWQAdministration.html">HAWQ Administration</a>
               <ul>
                  <li>
                     <a href="HAWQOverview.html">HAWQ Overview</a>
                  </li>
                  <li>
                     <a href="HAWQQueryProcessing.html">HAWQ Query Processing</a>
                  </li>
                  <li>
                     <a href="UsingHAWQtoQueryData.html">Using HAWQ to Query Data</a>
                  </li>
                  <li>
                     <a href="UsingProceduralLanguages.html">Using Procedural Languages</a>
                  </li>
                  <li>
                     <a href="ConfiguringClientAuthentication.html">Configuring Client Authentication</a>
                  </li>
                  <li>
                     <a href="ConfiguringKerberosAuthentication.html">Configuring Kerberos Authentication</a>
                  </li>
                  <li>
                     <a href="ConfiguringLDAPAuthentication.html">Configuring LDAP Authentication</a>
                  </li>
                  <li>
                     <a href="BackingUpandRestoringHAWQDatabases.html">Backing Up and Restoring HAWQ Databases</a>
                  </li>
                  <li>
                     <a href="ExpandingtheHAWQSystem.html">Expanding the HAWQ System</a>
                  </li>
                  <li>
                     <a href="HAWQInputFormatforMapReduce.html">HAWQ InputFormat for MapReduce</a>
                  </li>
                  <li>
                     <a href="HAWQFilespacesandHighAvailabilityEnabledHDFS.html">HAWQ Filespaces and High Availability Enabled HDFS</a>
                  </li>
                  <li>
                     <a href="SQLCommandReference.html">SQL Command Reference</a>
                     <ul>
                        <li>
                           <a href="ABORT.html">ABORT</a>
                        </li>
                        <li>
                           <a href="ANALYZE.html">ANALYZE</a>
                        </li>
                        <li>
                           <a href="ALTERAGGREGATE.html">ALTER AGGREGATE</a>
                        </li>
                        <li>
                           <a href="ALTERFUNCTION.html">ALTER FUNCTION</a>
                        </li>
                        <li>
                           <a href="ALTEROPERATOR.html">ALTER OPERATOR</a>
                        </li>
                        <li>
                           <a href="ALTEROPERATORCLASS.html">ALTER OPERATOR CLASS</a>
                        </li>
                        <li>
                           <a href="ALTERROLE.html">ALTER ROLE</a>
                        </li>
                        <li>
                           <a href="ALTERTABLE.html">ALTER TABLE</a>
                        </li>
                        <li>
                           <a href="ALTERTABLESPACE.html">ALTER TABLESPACE</a>
                        </li>
                        <li>
                           <a href="ALTERTYPE.html">ALTER TYPE</a>
                        </li>
                        <li>
                           <a href="ALTERUSER.html">ALTER USER</a>
                        </li>
                        <li>
                           <a href="BEGIN.html">BEGIN</a>
                        </li>
                        <li>
                           <a href="CHECKPOINT.html">CHECKPOINT</a>
                        </li>
                        <li>
                           <a href="CLOSE.html">CLOSE</a>
                        </li>
                        <li>
                           <a href="COMMIT.html">COMMIT</a>
                        </li>
                        <li>
                           <a href="COPY.html">COPY</a>
                        </li>
                        <li>
                           <a href="CREATEAGGREGATE.html">CREATE AGGREGATE</a>
                        </li>
                        <li>
                           <a href="CREATEDATABASE.html">CREATE DATABASE</a>
                        </li>
                        <li>
                           <a href="CREATEEXTERNALTABLE.html">CREATE EXTERNAL TABLE</a>
                        </li>
                        <li>
                           <a href="CREATEFUNCTION.html">CREATE FUNCTION</a>
                        </li>
                        <li>
                           <a href="CREATEGROUP.html">CREATE GROUP</a>
                        </li>
                        <li>
                           <a href="CREATELANGUAGE.html">CREATE LANGUAGE</a>
                        </li>
                        <li>
                           <a href="CREATEOPERATOR.html">CREATE OPERATOR</a>
                        </li>
                        <li>
                           <a href="CREATEOPERATORCLASS.html">CREATE OPERATOR CLASS</a>
                        </li>
                        <li>
                           <a href="CREATERESOURCEQUEUE.html">CREATE RESOURCE QUEUE</a>
                        </li>
                        <li>
                           <a href="CREATEROLE.html">CREATE ROLE</a>
                        </li>
                        <li>
                           <a href="CREATESCHEMA.html">CREATE SCHEMA</a>
                        </li>
                        <li>
                           <a href="CREATESEQUENCE.html">CREATE SEQUENCE</a>
                        </li>
                        <li>
                           <a href="CREATETABLE.html">CREATE TABLE</a>
                        </li>
                        <li>
                           <a href="CREATETABLEAS.html">CREATE TABLE AS</a>
                        </li>
                        <li>
                           <a href="CREATETABLESPACE.html">CREATE TABLESPACE</a>
                        </li>
                        <li>
                           <a href="CREATETYPE.html">CREATE TYPE</a>
                        </li>
                        <li>
                           <a href="CREATE-USER.html">CREATE USER</a>
                        </li>
                        <li>
                           <a href="CREATEVIEW.html">CREATE VIEW</a>
                        </li>
                        <li>
                           <a href="DEALLOCATE.html">DEALLOCATE</a>
                        </li>
                        <li>
                           <a href="DECLARE.html">DECLARE</a>
                        </li>
                        <li>
                           <a href="DROPAGGREGATE.html">DROP AGGREGATE</a>
                        </li>
                        <li>
                           <a href="DROPDATABASE.html">DROP DATABASE</a>
                        </li>
                        <li>
                           <a href="DROPEXTERNALTABLE.html">DROP EXTERNAL TABLE</a>
                        </li>
                        <li>
                           <a href="DROPFILESPACE.html">DROP FILESPACE</a>
                        </li>
                        <li>
                           <a href="DROPFUNCTION.html">DROP FUNCTION</a>
                        </li>
                        <li>
                           <a href="DROPGROUP.html">DROP GROUP</a>
                        </li>
                        <li>
                           <a href="DROPOPERATOR.html">DROP OPERATOR</a>
                        </li>
                        <li>
                           <a href="DROPOPERATORCLASS.html">DROP OPERATOR CLASS</a>
                        </li>
                        <li>
                           <a href="DROPOWNED.html">DROP OWNED</a>
                        </li>
                        <li>
                           <a href="DROPRESOURCEQUEUE.html">DROP RESOURCE QUEUE</a>
                        </li>
                        <li>
                           <a href="DROPROLE.html">DROP ROLE</a>
                        </li>
                        <li>
                           <a href="DROPSCHEMA.html">DROP SCHEMA</a>
                        </li>
                        <li>
                           <a href="DROPSEQUENCE.html">DROP SEQUENCE</a>
                        </li>
                        <li>
                           <a href="DROPTABLE.html">DROP TABLE</a>
                        </li>
                        <li>
                           <a href="DROPTABLESPACE.html">DROP TABLESPACE</a>
                        </li>
                        <li>
                           <a href="DROPTYPE.html">DROP TYPE</a>
                        </li>
                        <li>
                           <a href="DROP-USER.html">DROP USER</a>
                        </li>
                        <li>
                           <a href="DROPVIEW.html">DROP VIEW</a>
                        </li>
                        <li>
                           <a href="END.html">END</a>
                        </li>
                        <li>
                           <a href="EXECUTE.html">EXECUTE</a>
                        </li>
                        <li>
                           <a href="EXPLAIN.html">EXPLAIN</a>
                        </li>
                        <li>
                           <a href="FETCH.html">FETCH</a>
                        </li>
                        <li>
                           <a href="GRANT.html">GRANT</a>
                        </li>
                        <li>
                           <a href="INSERT.html">INSERT</a>
                        </li>
                        <li>
                           <a href="PREPARE.html">PREPARE</a>
                        </li>
                        <li>
                           <a href="REASSIGNOWNED.html">REASSIGN OWNED</a>
                        </li>
                        <li>
                           <a href="RELEASESAVEPOINT.html">RELEASE SAVEPOINT</a>
                        </li>
                        <li>
                           <a href="RESET.html">RESET</a>
                        </li>
                        <li>
                           <a href="REVOKE.html">REVOKE</a>
                        </li>
                        <li>
                           <a href="ROLLBACK.html">ROLLBACK</a>
                        </li>
                        <li>
                           <a href="ROLLBACKTOSAVEPOINT.html">ROLLBACK TO SAVEPOINT</a>
                        </li>
                        <li>
                           <a href="SAVEPOINT.html">SAVEPOINT</a>
                        </li>
                        <li>
                           <a href="SELECT.html">SELECT</a>
                        </li>
                        <li>
                           <a href="SELECTINTO.html">SELECT INTO</a>
                        </li>
                        <li>
                           <a href="SET.html">SET</a>
                        </li>
                        <li>
                           <a href="SETROLE.html">SET ROLE</a>
                        </li>
                        <li>
                           <a href="SETSESSIONAUTHORIZATION.html">SET SESSION AUTHORIZATION</a>
                        </li>
                        <li>
                           <a href="SHOW.html">SHOW</a>
                        </li>
                        <li>
                           <a href="TRUNCATE.html">TRUNCATE</a>
                        </li>
                        <li>
                           <a href="VACUUM.html">VACUUM</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="ManagementUtilityReference.html">Management Utility Reference</a>
                     <ul>
                        <li>
                           <a href="gpactivatestandby.html">gpactivatestandby</a>
                        </li>
                        <li>
                           <a href="gpcheckperf.html">gpcheckperf</a>
                        </li>
                        <li>
                           <a href="gpconfig.html">gpconfig</a>
                        </li>
                        <li>
                           <a href="gpexpand.html">gpexpand</a>
                        </li>
                        <li>
                           <a href="gpextract.html">gpextract</a>
                        </li>
                        <li>
                           <a href="gpfdist.html">gpfdist</a>
                        </li>
                        <li>
                           <a href="gpfilespace.html">gpfilespace</a>
                        </li>
                        <li>
                           <a href="gpinitstandby.html">gpinitstandby</a>
                        </li>
                        <li>
                           <a href="gpinitsystem.html">gpinitsystem</a>
                        </li>
                        <li>
                           <a href="gpload.html">gpload</a>
                        </li>
                        <li>
                           <a href="gplogfilter.html">gplogfilter</a>
                        </li>
                        <li>
                           <a href="gprecoverseg.html">gprecoverseg</a>
                        </li>
                        <li>
                           <a href="gpscp.html">gpscp</a>
                        </li>
                        <li>
                           <a href="gpstart.html">gpstart</a>
                        </li>
                        <li>
                           <a href="gpssh.html">gpssh</a>
                        </li>
                        <li>
                           <a href="gssh-exkeys.html">gssh-exkeys</a>
                        </li>
                        <li>
                           <a href="gpstate.html">gpstate</a>
                        </li>
                        <li>
                           <a href="gpstop.html">gpstop</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="ClientUtilityReference.html">Client Utility Reference</a>
                     <ul>
                        <li>
                           <a href="createdb.html">createdb</a>
                        </li>
                        <li>
                           <a href="createlang.html">createlang</a>
                        </li>
                        <li>
                           <a href="createuser.html">createuser</a>
                        </li>
                        <li>
                           <a href="dropdb.html">dropdb</a>
                        </li>
                        <li>
                           <a href="dropuser.html">dropuser</a>
                        </li>
                        <li>
                           <a href="pg_dump.html">pg_dump</a>
                        </li>
                        <li>
                           <a href="pg_dumpall.html">pg_dumpall</a>
                        </li>
                        <li>
                           <a href="pg_restore.html">pg_restore</a>
                        </li>
                        <li>
                           <a href="psql.html">psql</a>
                        </li>
                        <li>
                           <a href="vacuumdb.html">vacuumdb</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="HAWQServerConfigurationParameters.html">HAWQ Server Configuration Parameters</a>
                  </li>
                  <li>
                     <a href="CharacterSetSupportReference.html">Character Set Support Reference</a>
                  </li>
                  <li>
                     <a href="HAWQEnvironmentVariables.html">HAWQ Environment Variables</a>
                  </li>
                  <li>
                     <a href="HAWQDataTypes.html">HAWQ Data Types</a>
                  </li>
                  <li>
                     <a href="SystemCatalogReference.html">System Catalog Reference</a>
                  </li>
                  <li>
                     <a href="hawq_toolkitReference.html">hawq_toolkit Reference</a>
                  </li>
                  <li>
                     <a href="ManagingHAWQLogFiles.html">Managing HAWQ Log Files</a>
                  </li>
               </ul>
            </li>
            <li>
               <a href="PivotalExtensionFrameworkPXF.html">Pivotal Extension Framework (PXF)</a>
               <ul>
                  <li>
                     <a href="PXFInstallationandAdministration.html">PXF Installation and Administration</a>
                  </li>
                  <li>
                     <a href="PXFExternalTableandAPIReference.html">PXF External Table and API Reference</a>
                  </li>
               </ul>
            </li>
         </ul>

</div>
   
	<!-- end INSERT SIDENAV -->
	
	<main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container">Backing Up and Restoring HAWQ Databases</h1>
          <div id="js-quick-links"></div>          
        
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>     
        
		<!-- Python script replaces main content -->
		<div style="visibility:hidden; height:2px;">Pivotal Product Documentation : Backing Up and Restoring HAWQ Databases</div><div class="wiki-content group" id="main-content">
<p><style type="text/css">/*<![CDATA[*/
div.rbtoc1410924421196 {padding: 0px;}
div.rbtoc1410924421196 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1410924421196 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1410924421196">
<ul class="toc-indentation">
<li><a href="#BackingUpandRestoringHAWQDatabases-UsinggpfdistorPXF">Using gpfdist or PXF</a>
<ul class="toc-indentation">
<li><a href="#BackingUpandRestoringHAWQDatabases-PerformingaParallelBackup">Performing a Parallel Backup</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-RestoringfromaBackup">Restoring from a Backup</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-DifferencesbetweengpfdistandPXF">Differences between gpfdist and PXF </a></li>
</ul>
</li>
<li><a href="#BackingUpandRestoringHAWQDatabases-Usingpg_dumpandpg_restore">Using pg_dump and pg_restore</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-AboutBackingUpRawData">About Backing Up Raw Data</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-EstimatingtheBestPractice">Estimating the Best Practice </a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-EstimatingSpaceRequirements">Estimating Space Requirements</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-Usinggpfdist">Using gpfdist</a>
<ul class="toc-indentation">
<li><a href="#BackingUpandRestoringHAWQDatabases-Example">Example</a>
<ul class="toc-indentation">
<li><a href="#BackingUpandRestoringHAWQDatabases-Usinggpfdisttobackupthetpchdatabase:">Using gpfdist to back up the tpch database:</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-Torecoverusinggpfdist:">To recover using gpfdist:</a></li>
</ul>
</li>
<li><a href="#BackingUpandRestoringHAWQDatabases-Troubleshootinggpfdist">Troubleshooting gpfdist</a></li>
</ul>
</li>
<li><a href="#BackingUpandRestoringHAWQDatabases-UsingPXF">Using PXF</a>
<ul class="toc-indentation">
<li><a href="#BackingUpandRestoringHAWQDatabases-UsingPXFtobackupthetpchdatabase:">Using PXF to back up the tpch database:</a></li>
<li><a href="#BackingUpandRestoringHAWQDatabases-TorecoverfromaPXFbackup:">To recover from a PXF backup:</a></li>
</ul>
</li>
</ul>
</div></p><p>This chapter provides information on backing up and restoring databases in HAWQ system.</p><p>As an administrator, you will need to backup and restore your database. HAWQ provides three utilities to help you backup your data:</p><ul><li><code>gpfdist</code></li><li>PXF</li><li><code>pg_dump</code></li></ul><p><code>gpfdist</code> and PXF are parallel loading and unloading tools that provide the best performance.  You can use <code>pg_dump</code>, a non-parallel utility, to migrate from PostgreSQL to HAWQ. See About Parallel Backup and Restore using gpfdist or PXF and About Non-Parallel Backup and Restore using pg_dump and pg_restore.</p><p>This section describes these three utilities to help you decide what fits your needs.</p><p>For information about backing up raw data from ETL processes, see About Backup Raw Data.</p><h2 id="BackingUpandRestoringHAWQDatabases-UsinggpfdistorPXF">Using gpfdist or PXF</h2><p>You can perform a parallel backup in HAWQ using gpfdist or PXF to unload all data to external tables. Backup files can reside on a local file system or HDFS. To recover tables, you can load data back from external tables to the database. </p><h3 id="BackingUpandRestoringHAWQDatabases-PerformingaParallelBackup">Performing a Parallel Backup</h3><ol><li><p>Check the database size to ensure that the file system has enough space to save the backed up files.</p></li><li><p>Use the <code>pg_dump</code> utility to dump the schema of the target database.</p></li><li><p>Create a writable external table for each table to back up to that database.</p></li><li><p>Load table data into the newly created external tables.</p> <div class="aui-message warning shadowed information-macro">
<span class="aui-icon icon-warning">Icon</span>
<div class="message-content">
                            Pivotal recommends that you put the insert statements in a single transaction to prevent problems if you perform any update operations during the backup.
                    </div>
</div>
</li></ol><h3 id="BackingUpandRestoringHAWQDatabases-RestoringfromaBackup">Restoring from a Backup</h3><ol><li>Create a database to recover to.</li><li>Recreate the schema from the schema file (created during the <code>pg_dump</code> process).</li><li><p>Create a readable external table for each table in the database.</p></li><li><p>Load data from the external table to the actual table.</p></li><li>Run the ANALYZE command once loading is complete. This ensures that the query planner generates optimal plan based on up-to-date table statistics.</li></ol><h3 id="BackingUpandRestoringHAWQDatabases-DifferencesbetweengpfdistandPXF">Differences between gpfdist and PXF </h3><p>gpfdist and PXF differ in the following ways:</p><ul><li><code>gpfdist</code> stores backup files on local file system, while PXF stores files on HDFS.</li><li><code>gpfdist</code> only supports plain text format, while PXF also supports binary format like AVRO and customized format.</li><li><code>gpfdist</code> doesn’t support generating compressed file, while PXF supports compression (you can specify compression codec used in Hadoop like <code>org.apache.hadoop.io.compress.GzipCodec</code>).</li><li>Both <code>gpfdist</code> and PXF both have fast loading performance, but gpfdist is much faster than PXF.</li></ul><h2 id="BackingUpandRestoringHAWQDatabases-Usingpg_dumpandpg_restore">Using pg_dump and pg_restore</h2><p>HAWQ supports the PostgreSQL backup and restore utilities, <code>pg_dump</code> and <code>pg_restore</code>. The <code>pg_dump</code> utility creates a single, large dump file in the master host containing the data from all active segments. The <code>pg_restore</code> utility restores a HAWQ database from the archive created by <code>pg_dump</code>. In most cases, this is probably not practical, as there is most likely not enough disk space in the master host for creating a single backup file of an entire distributed database. HAWQ supports these utilities in case you are migrating data from PostgreSQL to HAWQ.</p><p>To create a backup archive for database <code>mydb</code>:</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">$ pg_dump -Ft -f mydb.tar mydb</pre>
</div></div><p>To create a compressed backup using custom format and compression level 3:</p></div><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">$ pg_dump -Fc -Z3 -f mydb.dump mydb</pre>
</div></div><p>To restore from an archive using <code>pg_restore</code>:</p></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">$ pg_restore -d new_db mydb.dump</pre>
</div></div><h2 id="BackingUpandRestoringHAWQDatabases-AboutBackingUpRawData">About Backing Up Raw Data</h2><p>Parallel backup using <code>gpfdist </code>or PXF works fine in most cases. There are a couple of situations where you cannot perform parallel backup and restore operations:</p><ul><li>Performing periodically incremental backups</li><li>Dumping a large data volume to external tables - this process takes a long time.</li></ul><p>In such situations, you can back up raw data generated during ETL processes and reload it into HAWQ. Pivotal recommends this approach due to it's incremental nature and the flexibility  to choose where you store backup files.</p><h2 id="BackingUpandRestoringHAWQDatabases-EstimatingtheBestPractice">Estimating the Best Practice </h2><p>The table below summaries the differences between the four approaches we discussed above. </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p align="left"><strong> </strong></p></td><td class="confluenceTd"><p align="left"><strong>gpfdist</strong></p></td><td class="confluenceTd"><p align="left"><strong>PXF</strong></p></td><td class="confluenceTd"><p align="left"><strong>pg_dump</strong></p></td><td class="confluenceTd" colspan="1"><strong>backup raw data</strong></td></tr><tr><td class="confluenceTd"><p align="left"><strong>Is Parallel</strong></p></td><td class="confluenceTd"><p align="left">Yes</p></td><td class="confluenceTd"><p align="left">Yes</p></td><td class="confluenceTd"><p align="left">No</p></td><td class="confluenceTd" colspan="1">No</td></tr><tr><td class="confluenceTd" colspan="1"><strong>Incremental Backup</strong></td><td class="confluenceTd" colspan="1">No</td><td class="confluenceTd" colspan="1">No</td><td class="confluenceTd" colspan="1">No</td><td class="confluenceTd" colspan="1">Yes</td></tr><tr><td class="confluenceTd"><p align="left"><strong>Backup Location</strong></p></td><td class="confluenceTd"><p align="left">Local FS</p></td><td class="confluenceTd"><p align="left">HDFS</p></td><td class="confluenceTd"><p align="left">Local FS</p></td><td class="confluenceTd" colspan="1">Local FS, HDFS</td></tr><tr><td class="confluenceTd"><p align="left"><strong>Format</strong></p></td><td class="confluenceTd"><p align="left">Text, CSV</p></td><td class="confluenceTd"><p align="left">Text, CSV, Custom</p></td><td class="confluenceTd"><p align="left">Text, Tar, Custom</p></td><td class="confluenceTd" colspan="1">Depends on format of row data</td></tr><tr><td class="confluenceTd"><p align="left"><strong>Compression</strong></p></td><td class="confluenceTd"><p align="left">No</p></td><td class="confluenceTd"><p align="left">Yes</p></td><td class="confluenceTd"><p align="left">Only support custom format</p></td><td class="confluenceTd" colspan="1">Optional</td></tr><tr><td class="confluenceTd"><p align="left"><strong>Scalability</strong></p></td><td class="confluenceTd"><p align="left">Good</p></td><td class="confluenceTd"><p align="left">Good</p></td><td class="confluenceTd"><p align="center">---</p></td><td class="confluenceTd" colspan="1">Good</td></tr><tr><td class="confluenceTd"><p align="left"><strong>Performance</strong></p></td><td class="confluenceTd"><p align="left">Fast loading,</p><p align="left">Fast unloading</p></td><td class="confluenceTd"><p align="left">Fast loading,</p><p align="left">Normal unloading</p></td><td class="confluenceTd"><p align="center">---</p></td><td class="confluenceTd" colspan="1">Fast (Just file copy)</td></tr></tbody></table></div><h2 id="BackingUpandRestoringHAWQDatabases-EstimatingSpaceRequirements">Estimating Space Requirements</h2><p>Before you backup your database, ensure that you have enough space to store backup files. This section describes how to get the database size and estimate space requirements.</p><ol style="list-style-type: square;"><li>Use <code>hawq_toolkit</code> to query size of the database you want to backup.<div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">mydb=# SELECT sodddatsize FROM hawq_toolkit.hawq_size_of_database WHERE sodddatname=’mydb’;</pre>
</div></div><p>If tables in your database are compressed, this query shows the compressed size of the database.</p></div><div><p> </p></div></li><li><p>Estimate the total size of the backup files.</p><p>-  If your database tables and backup files are both compressed, you can use the value <code>soddatsize</code> as an estimate value.</p><p>-  If your database tables are compressed  and backup files are not, you need to multiply <code>soddatsize</code> by the compression ratio. Although this depends on the compression algorithms,   <br/>    Pivotal recommends that you can use an empirical value such as 300%.</p><p>-  If your back files are compressed and database tables are not, you need to divide <code>soddatsize</code> by the compression ratio.</p></li><li>Get space requirement.</li></ol><p style="margin-left: 30.0px;">  -  If you use HDFS with PXF, the space requirement is <code>size_of_backup_files * replication_factor</code>.</p><p style="margin-left: 30.0px;"> -  If you use gpfdist, the space requirement for each gpfdist instance is <code>size_of_backup_files / num_gpfdist_instances</code> since table data will be evenly distributed to all    <br/>    <code>gpfdist </code>instances.</p><h2 id="BackingUpandRestoringHAWQDatabases-Usinggpfdist">Using gpfdist</h2><p>This section discusses <code>gpfdist</code> and shows an example of how to backup and restore HAWQ database.</p><p><code>gpfdist</code> is HAWQ’s parallel file distribution program. It is used by readable external tables and <code>gpload</code> to serve external table files to all HAWQ segments in parallel. It is used by writable external tables to accept output streams from HAWQ segments in parallel and write them out to a file.</p><p>To use <code>gpfdist</code>, start the <code>gpfdist</code> server program on the host where you want to store backup files. You can start multiple <code>gpfdist</code> instances on the same host or on different hosts. For each <code>gpfdist</code> instance, you specify a directory from which <code>gpfdist</code> will serve files for readable external tables or create output files for writable external tables. For example, if you have a dedicated machine for backup with two disks, you can start two <code>gpfdist</code> instances, each using one disk:</p><p><img class="confluence-embedded-image" data-image-src="attachments/72455931/72679990.png" src="attachments/72455931/72679990.png"/></p><p align="center" style="text-align: left;">Figure 1. Deploying multiple <code>gpfdist</code> instances on a backup host</p><p>You can also run <code>gpfdist</code> instances on each segment host. During backup, table data will be evenly distributed to all <code>gpfdist</code> instances specified in the <code>LOCATION</code> clause in the <code>CREATE EXTERNAL TABLE</code> definition.</p><p><img class="confluence-embedded-image" data-image-src="attachments/72455931/72679989.png" src="attachments/72455931/72679989.png"/></p><p align="center" style="text-align: left;">Figure 2. Deploying gpfdist instances on each segment host</p><h3 id="BackingUpandRestoringHAWQDatabases-Example">Example</h3><p>This example of using <code>gpfdist</code> backs up and restores a 1TB <em>tpch</em> database. To do so, start two <code>gpfdist</code> instances on the backup host <em>sdw1</em> with two 1TB disks (One disk mounts at <code>/data1</code>, another disk mounts at <code>/data2</code>).</p><h4 id="BackingUpandRestoringHAWQDatabases-Usinggpfdisttobackupthetpchdatabase:">Using gpfdist to back up the <em>tpch</em> database:</h4><ol><li>Creating backup locations and starting the <code>gpfdist</code> instances.<br/><p>In this example, issuing the first command creates two folders on two different disks with the same postfix “backup/tpch_20140627”. These folders are labeled as backups of the tpch database on 2014-06-27. In the next two commands, the example shows two gpfdist instances, one using port 8080, and another using port 8081.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">sdw1$ mkdir -p /data1/gpadmin/backup/tpch_20140627 /data2/gpadmin/backup/tpch_20140627
sdw1$ gpfdist -d /data1/gpadmin/backup/tpch_20140627 -p 8080 &amp;
sdw1$ gpfdist -d /data2/gpadmin/backup/tpch_20140627 -p 8081 &amp;</pre>
</div></div></div></li><li><p>Saving the schema for the database.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">master_host$ pg_dump --schema-only -f tpch.schema tpch
master_host$ scp tpch.schema sdw1:/data1/gpadmin/backup/tpch_20140627
</pre>
</div></div><p>On the HAWQ master host, use the <code>pg_dump</code> utility to save the schema of the tpch database to the file <em>tpch.schema</em>. Copy the schema file to the backup location to restore the database schema .</p><p> </p></li><li><p>Create a writable external table for each table in the database.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">master_host$ psql tpch
tpch=# create writable external table wext_orders (like orders) location ('gpfdist://sdw1:8080/orders1.csv', 'gpfdist://sdw1:8081/orders2.csv') format 'CSV';
tpch=# create writable external table wext_lineitem (like lineitem) location ('gpfdist://sdw1:8080/lineitem1.csv', 'gpfdist://sdw1:8081/lineitem2.csv') format 'CSV';</pre>
</div></div><p>The sample shows two tables in the tech database, <em>orders</em> and <em>line item</em> tables. The sample shows that two corresponding external tables are created. Specify a location or each gpfdist instance in the the LOCATION clause. This sample uses the CSV text format here, but you can also choose other delimited text format. See “CREATE EXTERNAL TABLE”.</p><p> </p></div></li><li><p>Unload data to the external tables.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">tpch=# begin;
tpch=# insert into wext_orders select * from orders;
tpch=# insert into wext_lineitem select * from lineitem;
tpch=# commit;</pre>
</div></div></div></li><li><p>(Optional) Stop gpfdist servers to free ports for other processes.</p><p>Find the progress id and kill the process.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">sdw1$ ps -ef | grep gpfdist
sdw1$ kill 612368; kill 612369</pre>
</div></div></div></li></ol><h4 id="BackingUpandRestoringHAWQDatabases-Torecoverusinggpfdist:">To recover using gpfdist:</h4><ol><li>Restart gpfdist instances if they aren’t running.<div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">sdw1$ gpfdist -d /data1/gpadmin/backup/tpch_20140627 -p 8080 &amp;
sdw1$ gpfdist -d /data2/gpadmin/backup/tpch_20140627 -p 8081 &amp;</pre>
</div></div></div></li><li><p>Create a new database and restore the schema.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">master_host$ createdb tpch2
master_host$ scp sdw1:/data1/gpadmin/backup/tpch_20140627/tpch.schema .
master_host$ psql -f tpch.schema -d tpch2</pre>
</div></div></div></li><li><p>Create a readable external table for each table.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">master_host$ psql tpch2

tpch2=# create external table rext_orders (like orders) location ('gpfdist://sdw1:8080/orders1.csv', 'gpfdist://sdw1:8081/orders2.csv') format 'CSV';
tpch2=# create external table rext_lineitem (like lineitem) location ('gpfdist://sdw1:8080/lineitem1.csv', 'gpfdist://sdw1:8081/lineitem2.csv') format 'CSV';</pre>
</div></div> <div class="aui-message warning shadowed information-macro">
<p class="title">Note</p>
<span class="aui-icon icon-warning">Icon</span>
<div class="message-content">
<p>The location clause is the same as the writable external table above.</p>
</div>
</div>
</div></li><li><p>Load data back from external tables.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">tpch2=# insert into orders select * from rext_orders;
tpch2=# insert into lineitem select * from rext_lineitem;</pre>
</div></div></div></li><li><p>Run the ANALYZE command after data loading.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">tpch2=# analyze;</pre>
</div></div></div></li></ol><h3 id="BackingUpandRestoringHAWQDatabases-Troubleshootinggpfdist">Troubleshooting gpfdist</h3><p>Keep in mind that gpfdist is accessed at runtime by the segment instances. Therefore, you must ensure that the HAWQ segment hosts have network access to gpfdist. Since the gpfdist program is a  web server, to test connectivity you can run the following command from each host in your HAWQ array (segments and master):</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">$ wget http://gpfdist_hostname:port/filename</pre>
</div></div><p> </p></div><p>Also, make sure that your CREATE EXTERNAL TABLE definition has the correct host name, port, and file names for gpfdist. The file names and paths specified should be relative to the directory where gpfdist is serving files (the directory path used when you started the gpfdist program). See “Defining External Tables - Examples”.</p><h2 id="BackingUpandRestoringHAWQDatabases-UsingPXF">Using PXF</h2><p>Pivotal Extension Framework (PXF) is an extensible framework that allows HAWQ to query external system data. The details of how to install and use PXF can be found in “PXF Installation and Administration”.</p><h4 id="BackingUpandRestoringHAWQDatabases-UsingPXFtobackupthetpchdatabase:">Using PXF to back up the <em>tpch</em> database:</h4><ol><li><p>Create a folder on HDFS for this backup.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">master_host$ hdfs dfs -mkdir -p /backup/tpch-2014-06-27</pre>
</div></div></li><li>Dump the database schema using <code>pg_dump</code> and store the schema file in a backup folder.<br/><div><p class="codesample"> </p></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">master_host$ pg_dump --schema-only -f tpch.schema tpch
master_host$ hdfs dfs -copyFromLocal tpch.schema /backup/tpch-2014-06-27</pre>
</div></div></li><li>Create a writable external table for each table in the database.<br/><div><p class="codesampleCxSpFirst"> </p></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">master_host$ psql tpch

tpch=# create writable external table wext_orders (like orders) location ('pxf://namenode_host:50070/backup/tpch-2014-06-27/orders?Profile=
HdfsTextSimple&amp;COMPRESSION_CODEC=org.apache.hadoop.io.compress.SnappyCodec') format 'TEXT';

tpch=# create writable external table wext_lineitem (like lineitem) location ('pxf://namenode_host:50070/backup/tpch-2014-06-27/lineitem?Profile=
HdfsTextSimple&amp;COMPRESSION_CODEC=org.apache.hadoop.io.compress.SnappyCodec') format 'TEXT';</pre>
</div></div><p>Here, all backup files for the orders table goes inside /backup/tpch-2014-06-27/orders folder, all backup files for the lineitem table goes inside /backup/tpch-2014-06-27/lineitem folder. We use snappy compression to save disk space.</p><p> </p></li><li><p>Unload the data to external tables.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">tpch=# begin;
tpch=# insert into wext_orders select * from orders;
tpch=# insert into wext_lineitem select * from lineitem;
tpch=# commit;</pre>
</div></div></div></li><li><p>(Optional) Change HDFS file replication factor for backup folder.<br/> HDFS replicates each block into three blocks by default for reliability. You can decrease this number for your backup files if you need to.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">master_host$ hdfs dfs -setrep 2 /backup/tpch-2014-06-27</pre>
</div></div> <div class="aui-message warning shadowed information-macro">
<span class="aui-icon icon-warning">Icon</span>
<div class="message-content">
                            Note that this only changes replication factor for existing files, new files will still use the default replication factor.
                    </div>
</div>
</li></ol><h4 id="BackingUpandRestoringHAWQDatabases-TorecoverfromaPXFbackup:">To recover from a PXF backup:</h4><ol><li>Create a new database and restore the schema.<br/><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: bash; gutter: false" style="font-size:12px;">master_host$ createdb tpch2
master_host$ hdfs dfs -copyToLocal /backup/tpch-2014-06-27/tpch.schema .
master_host$ psql -f tpch.schema -d tpch2</pre>
</div></div></div></li><li><p>Create readable external table for each table to restore.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">master_host$ psql tpch2
tpch2=# create external table rext_orders (like orders) location ('pxf://namenode_host:50070/backup/tpch-2014-06-27/orders?Profile=HdfsTextSimple') format 'TEXT';
tpch2=# create external table rext_lineitem (like lineitem) location ('pxf://namenode_host:50070/backup/tpch-2014-06-27/lineitem?Profile=HdfsTextSimple') format 'TEXT';</pre>
</div></div><p>The location clause is almost the same as above, except you don’t have to specify the COMPRESSION_CODEC because PXF will automatically detect it.</p><p> </p></div></li><li><p>Load data back from external tables.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">tpch2=# insert into orders select * from rext_orders;
tpch2=# insert into lineitem select * from rext_lineitem;</pre>
</div></div></div></li><li><p>Run ANALYZE after data loading.</p><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: sql; gutter: false" style="font-size:12px;">tpch2=# analyze;</pre>
</div></div></div></li></ol>
</div>
		
		</main><!--end of content-->

  </div><!-- end of container -->

  <script type="text/javascript">
    (function() {
      var didInit = false;
      function initMunchkin() {
        if(didInit === false) {
          didInit = true;
          Munchkin.init('625-IUJ-009');
        }
      }
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
      s.onreadystatechange = function() {
        if (this.readyState == 'complete' || this.readyState == 'loaded') {
          initMunchkin();
        }
      };
      s.onload = initMunchkin;
      document.getElementsByTagName('head')[0].appendChild(s);
    })();
  </script>
</div><!--end of wrap-->
</div><!--end of viewport-->

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
      <a href='/'>Pivotal Documentation</a>
      &copy; 2014 <a href='http://pivotal.io'>Pivotal Software</a> Inc. All Rights Reserved.
  </div>
  <div class="support">
    Need help? <a href="http://support.pivotal.io" target="_blank">Visit support</a>
  </footer>
</div><!--end of container-->

</body>
</html>


            
      
      
      
      